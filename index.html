<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>FlowChart Manager</title>
Â  <link rel="icon" type="image/png" href="https://static.wixstatic.com/media/c3283f_a3e1ec47496f42f7be617a2cd7a7bc9e~mv2.png">
Â  <style>
Â  Â  :root {
Â  Â  Â  --bg-primary: linear-gradient(135deg, #939ef5 0%, #9e76d6 100%);
Â  Â  Â  --bg-secondary: rgba(255, 255, 255, 0.1);
Â  Â  Â  --header-fixed-bg: #20232a;Â 
Â  Â  Â  --header-glass-border: rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  --text-primary: #333;
Â  Â  Â  --text-on-glass-light-bg: #1c1c1e;
Â  Â  Â  --text-on-header: white;Â 
Â  Â  Â  --text-filename: rgba(255, 255, 255, 0.9);Â 
Â  Â  Â  --input-bg: rgba(255, 255, 255, 0.2);
Â  Â  Â  --input-text: #1c1c1e;
Â  Â  Â  --input-border: rgba(200, 200, 220, 0.4);Â 
Â  Â  Â  --input-light-border: rgba(200, 200, 220, 0.3);
Â  Â  Â  --button-bg: rgba(255, 255, 255, 0.25);Â 
Â  Â  Â  --button-text: var(--text-on-glass-light-bg);Â 
Â  Â  Â  --button-hover-bg: rgba(255, 255, 255, 0.4);
Â  Â  Â  --modal-base-bg-rgb: 255, 255, 255;
Â  Â  Â  --modal-bg-alpha: 0.3;Â 
Â  Â  Â  --modal-bg: rgba(var(--modal-base-bg-rgb), var(--modal-bg-alpha));
Â  Â  Â  --modal-text: var(--text-on-glass-light-bg);
Â  Â  Â  --close-button-color: rgba(0,0,0, 0.5);
Â  Â  Â  --close-button-hover-color: #000;
Â  Â  Â  --flowchart-container-bg: rgba(255, 255, 255, 0.15);Â 
Â  Â  Â  --flowchart-container-border: rgba(200, 200, 220, 0.3);
Â  Â  Â  --node-text-fill: var(--text-on-glass-light-bg);
Â  Â  Â  --node-fill-opacity: 0.55;Â 
Â  Â  Â  --task-count-rect-bg: rgba(44, 62, 80, 0.75);
Â  Â  Â  --task-count-text-fill: white;
Â  Â  Â  --task-count-border: rgba(255, 255, 255, 0.2);
Â  Â  Â  --selected-swatch-outline: var(--text-on-glass-light-bg);Â 
Â  Â  Â  --selected-row-bg: rgba(200, 210, 225, 0.3);
Â  Â  Â  --selected-row-border: rgba(52, 152, 219, 0.8);
Â  Â  Â  --table-header-separator: rgba(0, 0, 0, 0.2);
Â  Â  Â  --th-text-color: var(--text-on-glass-light-bg);
Â  Â  Â  --glass-bg: var(--modal-bg);Â 
Â  Â  Â  --glass-border: rgba(200, 200, 220, 0.4);Â 
Â  Â  Â  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);Â 
Â  Â  Â  --modal-strong-shadow: 0 15px 45px rgba(0, 0, 0, 0.15);Â 
Â  Â  Â  --backdrop-blur: 10px;
Â  Â  }

Â  Â  body.dark-mode {
Â  Â  Â  --bg-primary: linear-gradient(135deg, #101020 0%, #0c1428 50%, #08203f 100%);
Â  Â  Â  --text-primary: #e0e0e0;
Â  Â  Â  --text-on-glass-light-bg: #e0e0e0;Â 
Â  Â  Â  --text-on-header: #e0e0e0;
Â  Â  Â  --text-filename: rgba(255, 255, 255, 0.8);Â 
Â  Â  Â  --input-bg: rgba(255, 255, 255, 0.1);
Â  Â  Â  --input-text: #e0e0e0;
Â  Â  Â  --input-border: rgba(255, 255, 255, 0.2);
Â  Â  Â  --input-light-border: rgba(255, 255, 255, 0.1);
Â  Â  Â  --button-bg: rgba(255, 255, 255, 0.12);Â 
Â  Â  Â  --button-text: #e0e0e0;Â 
Â  Â  Â  --button-hover-bg: rgba(255, 255, 255, 0.22);
Â  Â  Â  --modal-base-bg-rgb: 25, 30, 45;Â 
Â  Â  Â  --modal-bg-alpha: 0.5;Â 
Â  Â  Â  --modal-bg: rgba(var(--modal-base-bg-rgb), var(--modal-bg-alpha));
Â  Â  Â  --modal-text: #e0e0e0;
Â  Â  Â  --close-button-color: rgba(255, 255, 255, 0.6);
Â  Â  Â  --close-button-hover-color: #e0e0e0;
Â  Â  Â  --flowchart-container-bg: rgba(10, 10, 20, 0.1);Â 
Â  Â  Â  --flowchart-container-border: rgba(255, 255, 255, 0.1);
Â  Â  Â  --node-text-fill: #e0e0e0;
Â  Â  Â  --node-fill-opacity: 0.5;Â 
Â  Â  Â  --task-count-rect-bg: rgba(220, 220, 230, 0.7);Â 
Â  Â  Â  --task-count-text-fill: #1a1a2e;Â 
Â  Â  Â  --task-count-border: rgba(255, 255, 255, 0.15);
Â  Â  Â  --selected-swatch-outline: #e0e0e0;
Â  Â  Â  --selected-row-bg: rgba(255, 255, 255, 0.1);
Â  Â  Â  --selected-row-border: rgba(93, 173, 226, 0.8);
Â  Â  Â  --table-header-separator: rgba(255, 255, 255, 0.15);
Â  Â  Â  --th-text-color: #e0e0e0;
Â  Â  Â  --glass-bg: var(--modal-bg);Â 
Â  Â  Â  --glass-border: rgba(255, 255, 255, 0.15);
Â  Â  Â  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
Â  Â  Â  --modal-strong-shadow: 0 15px 45px rgba(0, 0, 0, 0.4);
Â  Â  Â  --backdrop-blur: 15px;
Â  Â  }

Â  Â  * { box-sizing: border-box; }
Â  Â  body { margin: 0; font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); display: flex; flex-direction: column; min-height: 100vh; transition: background 0.5s ease; position: relative; overflow-x: hidden; }
Â  Â  body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); z-index: -1; transition: background 0.5s ease;}
Â  Â  header { background: var(--header-fixed-bg); backdrop-filter: blur(var(--backdrop-blur)); -webkit-backdrop-filter: blur(var(--backdrop-blur)); border-bottom: 1px solid var(--header-glass-border); box-shadow: 0 4px 12px rgba(0,0,0,0.3); color: var(--text-on-header); padding: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; position: relative; transition: background 0.3s ease, border-color 0.3s ease; }
Â  Â  header h1 { margin: 0; display: flex; align-items: center; font-size: 1.8em; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
Â  Â  #headerLogo { width: 32px; height: 32px; margin-right: 12px; vertical-align: middle; }
Â  Â  header h1 input#flowchartNameInput { margin-left: 15px; font-size: 0.65em; padding: 8px 16px; border: 1px solid var(--input-border); border-radius: 12px; background: var(--input-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--input-text); transition: all 0.3s ease; font-weight: 400; }
Â  Â  header h1 input#flowchartNameInput:focus { outline: none; border-color: var(--glass-border); box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1); transform: translateY(-1px); }
Â  Â  nav { display: flex; align-items: center; flex-wrap: wrap; gap: 0.75rem; }
Â  Â  nav button, #themeToggleBtn, .template-btn, .action-buttons button, #deleteNodeBtn, .confirm-action-btn, #deleteTaskBtn, button {Â 
Â  Â  Â  background: var(--button-bg);Â 
Â  Â  Â  backdrop-filter: blur(var(--backdrop-blur));Â 
Â  Â  Â  -webkit-backdrop-filter: blur(var(--backdrop-blur));Â 
Â  Â  Â  border: 1px solid var(--glass-border);Â 
Â  Â  Â  color: var(--button-text);Â 
Â  Â  Â  padding: 0.75rem 1rem;Â 
Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  border-radius: 12px;Â 
Â  Â  Â  white-space: nowrap;Â 
Â  Â  Â  font-family: 'Inter', 'Segoe UI', sans-serif;Â 
Â  Â  Â  font-size: 0.85em;Â 
Â  Â  Â  font-weight: 500;Â 
Â  Â  Â  transition: all 0.3s ease;Â 
Â  Â  Â  position: relative;Â 
Â  Â  Â  overflow: hidden;Â 
Â  Â  }
Â  Â  nav button::before, #themeToggleBtn::before, button::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transition: left 0.5s ease; }
Â  Â  nav button:hover::before, #themeToggleBtn:hover::before, button:hover::before { left: 100%; }
Â  Â  nav button:hover, #themeToggleBtn:hover, button:hover { background: var(--button-hover-bg); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }
Â  Â  nav button:active, #themeToggleBtn:active, button:active { transform: translateY(0); }
Â  Â Â 
Â  Â  #themeToggleBtn { padding: 0.75rem; font-size: 1.2em; width: auto; min-width: 45px; height: auto; aspect-ratio: 1/1; }
Â  Â  nav input[type="file"] { display: none; }
Â  Â  nav .node-size-btn { padding: 0.75rem 0.8rem; }Â 
Â  Â  #fileNameDisplay { margin-left: 1rem; font-size: 0.9em; color: var(--text-on-header); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); }
Â  Â Â 
Â  Â  #flowchartContainer { width: calc(100% - 2rem); flex-grow: 1; border: 1px solid var(--flowchart-container-border); background: var(--flowchart-container-bg); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); overflow: hidden; position: relative; margin: 1rem; border-radius: 20px; box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1); transition: background 0.3s ease, border-color 0.3s ease; }
Â  Â  #flowchart { display: block; width: 100%; height: 100%; }
Â  Â  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); padding-top: 50px; overflow-y: auto; }
Â  Â  .modal-content { background: var(--modal-bg); backdrop-filter: blur(var(--backdrop-blur)); -webkit-backdrop-filter: blur(var(--backdrop-blur)); border: 1px solid var(--glass-border); color: var(--modal-text); margin: 20px auto; padding: 2rem; width: 90%; max-width: 750px; /* Increased width for user guide */ overflow-y: auto; max-height: calc(100vh - 100px); border-radius: 20px; position: relative; box-shadow: var(--modal-strong-shadow); transition: background 0.3s ease, border-color 0.3s ease; }
Â  Â  .close-button { position: absolute; right: 15px; top: 15px; font-size: 24px; cursor: pointer; color: var(--close-button-color); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(255, 255, 255, 0.1); transition: all 0.3s ease; z-index: 10; }
Â  Â  .close-button:hover { color: var(--close-button-hover-color); background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
Â  Â  form { display: flex; flex-direction: column; gap: 1rem; }
Â  Â  input, select, textarea { padding: 12px 16px; border: 1px solid var(--input-border); border-radius: 12px; font-size: 1em; background: var(--input-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--input-text); font-family: 'Inter', 'Segoe UI', sans-serif; transition: all 0.3s ease; }
Â  Â  input:focus, select:focus, textarea:focus { outline: none; border-color: var(--glass-border); box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1); transform: translateY(-1px); }
Â  Â  textarea { resize: vertical; min-height: 80px; }
Â  Â  #taskName { width: 100%; }
Â  Â  Â  Â Â 
Â  Â  .flowchart-node-html-wrapper { overflow: visible; }
Â  Â  .flowchart-node-html {
Â  Â  Â  backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  -webkit-backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  Â  box-shadow: var(--modal-strong-shadow);Â 
Â  Â  Â  border-radius: 18px;Â 
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;Â 
Â  Â  Â  padding: 12px;Â 
Â  Â  Â  padding-top: 32px; /* Ensure space for pill and priority */
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  color: var(--node-text-fill);
Â  Â  Â  text-align: center;
Â  Â  Â  cursor: move;
Â  Â  Â  position: relative;Â 
Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
Â  Â  }
Â  Â  .node-name-html {
Â  Â  Â  font-weight: 500;
Â  Â  Â  text-shadow: 0 1px 3px rgba(0,0,0,0.2);
Â  Â  Â  word-break: break-word;Â 
Â  Â  Â  max-width: 100%;
Â  Â  Â  width: 100%;Â 
Â  Â  Â  max-height: 100%;Â 
Â  Â  Â  overflow: hidden;Â 
Â  Â  }
Â  Â  body.dark-mode .node-name-html { text-shadow: 0 1px 4px rgba(0,0,0,0.35); }

Â  Â  .task-count-pill-html {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 8px;Â 
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  background: var(--task-count-rect-bg);
Â  Â  Â  color: var(--task-count-text-fill);
Â  Â  Â  padding: 5px 12px;Â 
Â  Â  Â  border-radius: 14px;Â 
Â  Â  Â  font-weight: 600;
Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
Â  Â  Â  border: 1px solid var(--task-count-border);
Â  Â  Â  backdrop-filter: blur(4px);
Â  Â  Â  -webkit-backdrop-filter: blur(4px);
Â  Â  Â  white-space: nowrap;
Â  Â  Â  z-index: 5;Â 
Â  Â  Â  transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
Â  Â  }

    /* --- START: Added CSS for Priority Indicator --- */
    .priority-indicator {
        position: absolute;
        top: 10px; /* Align with task count pill, adjust as needed */
        right: 10px;
        display: flex;
        gap: 3px; /* Space between dots */
        z-index: 6; /* Ensure it's visible */
    }

    .priority-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%; /* Makes it a circle */
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .priority-dot-active {
        background-color: orangered; /* Red/Orange for active */
    }

    .priority-dot-inactive {
        background-color: #f0f0f0; /* White-ish for inactive */
        border: 1px solid #ccc; /* Light border to make it visible on light backgrounds */
    }
    /* --- END: Added CSS for Priority Indicator --- */

Â  Â  #userGuideModal .modal-content h2 { font-size: 1.5em; margin-bottom: 1em; }
Â  Â  #userGuideModal .modal-content h3 { margin-top: 1.5em; margin-bottom: 0.5em; font-size: 1.15em; color: var(--modal-text); }
Â  Â  #userGuideModal .modal-content ul { list-style-type: none; padding-left: 10px; }
Â  Â  #userGuideModal .modal-content li { margin-bottom: 0.7em; line-height: 1.6; }
Â  Â  #userGuideModal .modal-content li strong { font-weight: 600; color: var(--modal-text); }
Â  Â  #userGuideModal .modal-content p { margin-bottom: 1em; line-height: 1.6; }

Â  Â  .action-buttons { display: flex; gap: 15px; margin-top: 20px; }
Â  Â  .color-panel { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; margin-bottom: 12px; }
Â  Â  .color-swatch { width: 32px; height: 32px; border: 2px solid var(--glass-border); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
Â  Â  .color-swatch:hover { transform: scale(1.15) translateY(-2px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); }
Â  Â  .selected-swatch { outline: 3px solid var(--selected-swatch-outline); outline-offset: 3px; transform: scale(1.1); }
Â  Â  .selectedTaskRow { border: 2px solid var(--selected-row-border); background: var(--selected-row-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 8px; }
Â  Â  #taskTable { width:100%; margin-bottom:15px; border-collapse: collapse; }
Â  Â  #taskTable th { text-align: left; padding-bottom: 8px; border-bottom: 2px solid var(--table-header-separator); color: var(--th-text-color); font-weight: 600; }
Â  Â  #taskTable td { padding-top: 8px; }
Â  Â  .task-detail-textarea { width: 100%; resize: vertical; border: 1px solid var(--input-light-border); padding: 8px 12px; background: var(--input-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--input-text); border-radius: 8px; font-size: 0.9em; min-height: 3em; transition: all 0.3s ease; }
Â  Â  .task-detail-textarea:focus { border-color: var(--glass-border); box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1); }
Â  Â  Â  Â Â 
Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  header { flex-direction: column; align-items: flex-start; gap: 1rem; padding: 1rem; }
Â  Â  Â  Â  header h1 { font-size: 1.5em; width: 100%; justify-content: space-between; }
Â  Â  Â  Â  nav { width: 100%; flex-wrap: wrap; gap: 0.5rem; }Â 
Â  Â  Â  Â  nav button, #themeToggleBtn { flex-grow: 1; min-width: calc(33.33% - 1rem); font-size: 0.8em; padding: 0.6rem 0.8rem; }Â 
Â  Â  Â  Â  #fileNameDisplay { width: 100%; text-align: center; margin-top: 0.5rem; margin-left: 0; max-width: none; }
Â  Â  Â  Â  .modal-content { width: 95%; padding: 1.5rem; margin: 10px auto; max-height: calc(100vh - 40px); }
Â  Â  Â  Â  #flowchartContainer { height: 70vh; margin: 0.5rem; width: calc(100% - 1rem); }
Â  Â  }
Â  Â  @media (max-width: 480px) {
Â  Â  Â  Â  header h1 { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
Â  Â  Â  Â  header h1 input#flowchartNameInput { margin-left: 0; width: 100%; }
Â  Â  Â  Â  nav button, #themeToggleBtn { font-size: 0.75em; padding: 0.5rem 0.7rem; min-width: calc(50% - 0.75rem); }
Â  Â  Â  Â  #themeToggleBtn { flex-grow: 0; min-width: 40px; }
Â  Â  }
Â  </style>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
<header>
Â  <h1>Â 
Â  Â  <img src="https://static.wixstatic.com/media/c3283f_a3e1ec47496f42f7be617a2cd7a7bc9e~mv2.png" alt="Logo" id="headerLogo">
Â  Â  FlowChart ManagerÂ 
Â  Â  <input type="text" id="flowchartNameInput" placeholder="Enter Flowchart Name...">Â 
Â  </h1>
Â  <nav>
Â  Â  <button id="nodeSizeIncreaseBtn" class="node-size-btn">Node Size +</button>
Â  Â  <button id="nodeSizeDecreaseBtn" class="node-size-btn">Node Size -</button>
Â  Â  <button id="aiAssistantBtn" class="ai-assistant-btn">Flowchart AI Assistant</button>
Â  Â  <button id="userGuideBtn" class="user-guide-btn">User Guide</button>
Â  Â  <button id="templateBtn">Templates</button>
Â  Â  <button id="saveBtn">Save</button>
Â  Â  <input type="file" id="fileInput" accept=".json">
Â  Â  <button id="uploadBtn" class="upload-btn">Upload</button>
Â  Â  <div id="fileNameDisplay">No file loaded</div>
Â  Â  <button id="themeToggleBtn" title="Toggle theme">ğŸŒ“</button>
Â  </nav>
</header>
<div id="flowchartContainer"><svg id="flowchart"></svg></div>

<div id="modal" class="modal"> <div class="modal-content"> <span class="close-button" id="closeModal">Ã—</span> <h2>Task Details</h2> <form id="taskForm"> <label>Task Name: <textarea id="taskName" required></textarea> </label> <label>Responsible: <input type="text" id="responsible" required> </label> <label>Status: <select id="status"> <option value="Not Started">Not Started</option> <option value="In Progress">In Progress</option> <option value="Completed">Completed</option> </select> </label> <label>Deadline: <input type="date" id="deadline"> </label> <label>Priority: <select id="priority"> <option value="Low">Low</option> <option value="Normal">Normal</option> <option value="High">High</option> </select> </label> <label>Action Description (Sub-tasks):</label> <table id="taskTable"> <thead> <tr> <th style="width: 30px;">âœ“</th> <th>Task</th> </tr> </thead> <tbody></tbody> </table> <button type="button" id="addTaskRowBtn" class="confirm-action-btn">Add Task</button> <label>Node Color:</label> <input type="hidden" id="nodeColor" /> <div class="color-panel"> <div class="color-swatch" style="background-color: #e74c3c;" data-color="#e74c3c"></div> <div class="color-swatch" style="background-color: #f1c40f;" data-color="#f1c40f"></div> <div class="color-swatch" style="background-color: #2ecc71;" data-color="#2ecc71"></div> <div class="color-swatch" style="background-color: #3498db;" data-color="#3498db"></div> <div class="color-swatch" style="background-color: #9b59b6;" data-color="#9b59b6"></div> <div class="color-swatch" style="background-color: #34495e;" data-color="#34495e"></div> </div> <div class="action-buttons"> <button type="submit" class="save-btn">Save Node</button> <button type="button" class="add-node-btn" id="addNodeBtn">Add Child Node</button> </div> <div style="text-align: center; margin-top: 20px;"> <button type="button" id="deleteNodeBtn">Delete Node</button> </div> </form> </div> </div>

<div id="templateModal" class="modal"> <div class="modal-content"> <span class="close-button" id="closeTemplateModal">Ã—</span> <h2>Select Template</h2> <button class="template-btn" data-template="prototype">Prototype Development</button> <button class="template-btn" data-template="vendor">Vendor Outreach</button> <button class="template-btn" data-template="marketing">Marketing Campaign</button> </div> </div>

<div id="taskTextPopup" class="modal"> <div class="modal-content"> <span class="close-button" id="closeTaskPopup">Ã—</span> <p id="taskFullText" style="white-space: pre-wrap; max-height: 60vh; overflow-y: auto;"></p> <button id="deleteTaskBtn">Delete Task</button> </div> </div>

<div id="userGuideModal" class="modal">
Â  <div class="modal-content">
Â  Â  <span class="close-button" id="closeUserGuideModal">Ã—</span>
Â  Â  <h2>ğŸ“˜ FlowChart Manager â€“ User Guide</h2>

Â  Â  <h3>ğŸ› ï¸ Interface Controls</h3>
Â  Â  <ul>
Â  Â  Â  <li><strong>Upload</strong> â€“ Import a FlowChart (json) file to continue work or load a new chart.</li>
Â  Â  Â  <li><strong>Save</strong> â€“ Saving a FlowChart will always create a new file version each time.</li>
Â  Â  Â  <li><strong>Templates</strong> â€“ Start with a ready-made structure (Prototype, Vendor, or Marketing).</li>
Â  Â  Â  <li><strong>Node Size +/-</strong> â€“ Resize task nodes for better visibility.</li>
Â  Â  Â  <li><strong>Flowchart AI Assistant</strong> â€“ Get expert guidance to refine, organize, or expand your chart.</li>
Â  Â  </ul>

Â  Â  <h3>ğŸ§© Working with Tasks</h3>
Â  Â  <p>Click any node to view or edit its details. Completing fields like Responsible, Deadline, and Priority helps align your workflow, track progress, and maintain clarity.</p>

Â  Â  <h3>ğŸ’¡Tips for Effective Use</h3>
Â  Â  <ul>
Â  Â  Â  <li>Start with a template if unsureâ€”it gives structure fast.</li>
Â  Â  Â  <li>Organize nodes clockwise or top-down for clear readability.</li>
Â  Â  Â  <li>Save regularly to avoid losing progress.</li>
Â  Â  Â  <li>Use concise task names and clear action descriptions.</li>
Â  Â  Â  <li>Keep Phase nodes separate and use them to group related tasks.</li>
Â  Â  </ul>

Â  Â  <h3>ğŸ§  Need Smart Help?</h3>
Â  Â  <p>Click the FlowChart AI button to open the FlowChat GPT.</p>
    <p>Upload your FlowChart file in chat and ask the Assistant to:</p>
    <p> analyze, provide insights, add tasks, change details, create a report, etc.</p>
Â  Â  <ul>
Â  Â  Â  <li>Analyze structure</li>
Â  Â  Â  <li>Suggest improvements</li>
Â  Â  Â  <li>Refine phases</li>
Â  Â  Â  <li>Streamline your flow for cohesive execution</li>
Â  Â  </ul>
Â  </div>
</div>

<script>
Â  // --- Theme Toggle Script ---
Â  try {
Â  Â  const themeToggleBtn = document.getElementById('themeToggleBtn');
Â  Â  const currentDocumentBody = document.body;
Â  Â  const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
Â  Â  function applyTheme(theme) { currentDocumentBody.classList.toggle('dark-mode', theme === 'dark'); }
Â  Â  if (themeToggleBtn && currentDocumentBody && prefersDarkScheme) {
Â  Â  Â  const savedTheme = localStorage.getItem('theme');
Â  Â  Â  applyTheme(savedTheme ? savedTheme : (prefersDarkScheme.matches ? 'dark' : 'light'));
Â  Â  Â  themeToggleBtn.addEventListener('click', () => { const newTheme = currentDocumentBody.classList.contains('dark-mode') ? 'light' : 'dark'; applyTheme(newTheme); localStorage.setItem('theme', newTheme); });
Â  Â  Â  prefersDarkScheme.addEventListener('change', (e) => { if (!localStorage.getItem('theme')) applyTheme(e.matches ? 'dark' : 'light'); });
Â  Â  } else console.error("Theme toggle critical elements missing.");
Â  } catch (themeError) { console.error("Theme script error:", themeError); }

Â  // --- Main Application Script ---
Â  function openAIAssistant() { const url = 'https://chatgpt.com/g/g-678c450b02988191b07d47c7a5bd9d4a-flow-chart-assistant', sW=window.screen.availWidth,sH=window.screen.availHeight,bS=Math.min(sW,sH),pW=Math.floor(bS*0.45),pH=Math.floor(bS*0.55),l=Math.floor((sW-pW)/2),t=Math.floor((sH-pH)/2); window.open(url,'FlowchartAIAssistant',`width=${pW},height=${pH},left=${l},top=${t},resizable=yes,scrollbars=yes,status=no,location=no,menubar=no,toolbar=no`); }
Â Â 
Â  let selectedNode=null,data={flowchartName:"Untitled Flowchart",nodes:[],links:[]},simulation,svg,nodeGroup,mainZoomGroup;
Â  const BASE_NODE_DIMENSION = 160;Â 
Â  let currentNodeSizeFactor=1.0;Â 
Â  const MIN_NODE_SIZE_FACTOR=0.5,MAX_NODE_SIZE_FACTOR=1.5,NODE_SIZE_STEP=0.1;

Â  function hexToRgba(hex, alpha = 1) {
Â  Â  if (!hex || typeof hex !== 'string') return `rgba(200,200,200,${alpha})`;
Â  Â  hex = hex.replace('#', '');
Â  Â  let r = 0, g = 0, b = 0;
Â  Â  if (hex.length === 3) {Â 
Â  Â  Â  r = parseInt(hex[0] + hex[0], 16); g = parseInt(hex[1] + hex[1], 16); b = parseInt(hex[2] + hex[2], 16);
Â  Â  } else if (hex.length === 6) {
Â  Â  Â  r = parseInt(hex.substring(0, 2), 16); g = parseInt(hex.substring(2, 4), 16); b = parseInt(hex.substring(4, 6), 16);
Â  Â  } else { return `rgba(128, 128, 128, ${alpha})`; }
Â  Â  if (isNaN(r) || isNaN(g) || isNaN(b)) return `rgba(128,128,128,${alpha})`;
Â  Â  return `rgba(${r},${g},${b},${alpha})`;
Â  }

Â  function initD3() {
Â  Â  const fcCont = document.getElementById('flowchartContainer');
Â  Â  d3.select(fcCont).select("svg").remove();
Â  Â  const cW=fcCont.clientWidth,cH=fcCont.clientHeight,vW=Math.max(cW*1.5,2000),vH=Math.max(cH*1.5,1500);
Â  Â  svg=d3.select(fcCont).append('svg').attr('id','flowchart').attr('width',"100%").attr('height',"100%").attr('viewBox',`0 0 ${vW} ${vH}`).attr('preserveAspectRatio','xMidYMid meet');
Â  Â  mainZoomGroup=svg.append('g');
Â  Â  const zm=d3.zoom().on("zoom",(ev)=>mainZoomGroup.attr("transform",ev.transform));svg.call(zm).on("dblclick.zoom",null);
Â  Â  mainZoomGroup.append('defs');Â 
Â  Â  const scaledNodeDimension = BASE_NODE_DIMENSION * currentNodeSizeFactor;
Â  Â  simulation=d3.forceSimulation()
Â  Â  Â  .force('charge',d3.forceManyBody().strength(-1800 * (scaledNodeDimension/160) ))Â 
Â  Â  Â  .force('collide',d3.forceCollide().radius((scaledNodeDimension*0.55)+25).strength(0.9))Â 
Â  Â  Â  .force('center',d3.forceCenter(vW/2,vH/2));
Â  Â  nodeGroup=mainZoomGroup.append('g').attr("class","nodes");Â 
Â  Â  window.addEventListener('resize',()=>{const nCW=fcCont.clientWidth,nCH=fcCont.clientHeight,nV_W=Math.max(nCW*1.5,vW),nV_H=Math.max(nCH*1.5,vH);simulation.force('center',d3.forceCenter(nV_W/2,nV_H/2)).alpha(0.3).restart();});
Â  }

Â  function placeNodesDiagonally(){const iX=(mainZoomGroup.node()?parseFloat(svg.attr('viewBox').split(' ')[2])/2:1000),iY=150,cSD=BASE_NODE_DIMENSION*currentNodeSizeFactor,hS=cSD*1.75,vS=cSD*1.25;data.nodes.forEach((n,i)=>{if(n.x==null||n.fx==null){n.x=iX+(i%3-1)*hS+(Math.random()*50-25);n.fx=n.x;}if(n.y==null||n.fy==null){n.y=iY+Math.floor(i/3)*vS+(Math.random()*50-25);n.fy=n.y;}});};
Â  function addTaskRow(t){const tb=document.querySelector('#taskTable tbody'),tr=document.createElement('tr');tr.addEventListener('click',function(){document.querySelectorAll('#taskTable tbody tr').forEach(r=>r.classList.remove('selectedTaskRow'));this.classList.add('selectedTaskRow');});const tdC=document.createElement('td'),cb=document.createElement('input');cb.type='checkbox';cb.checked=t&&t.completed?true:false;tdC.appendChild(cb);const tdT=document.createElement('td'),ti=document.createElement('textarea');ti.classList.add('task-detail-textarea');ti.value=t&&t.task?t.task:'';ti.rows=1;ti.addEventListener('input',function(){this.style.height='auto';this.style.height=(this.scrollHeight)+'px';});ti.addEventListener('dblclick',function(e){e.stopPropagation();tr.classList.add('selectedTaskRow');showTaskPopup(this.value);});let pT;ti.addEventListener('touchstart',function(e){e.stopPropagation();pT=window.setTimeout(()=>{tr.classList.add('selectedTaskRow');showTaskPopup(this.value);},800);});ti.addEventListener('touchend',function(){clearTimeout(pT);});ti.addEventListener('touchmove',function(){clearTimeout(pT);});tdT.appendChild(ti);tr.appendChild(tdC);tr.appendChild(tdT);tb.appendChild(tr);ti.dispatchEvent(new Event('input'));};
Â  function populateTaskTable(str){const tb=document.querySelector('#taskTable tbody');tb.innerHTML='';let arr=[];if(str&&typeof str==='string'){try{arr=JSON.parse(str);if(!Array.isArray(arr))arr=str.trim()?[{completed:false,task:str}]:[];}catch(e){arr=str.trim()?[{completed:false,task:str}]:[];}}else if(Array.isArray(str))arr=str;if(arr.length>0)arr.forEach(t=>addTaskRow(t));else addTaskRow({});};
Â  function showTaskPopup(txt){document.getElementById('taskFullText').textContent=txt;document.getElementById('taskTextPopup').style.display='block';};
Â  function nodeClick(ev,d){ev.stopPropagation();selectedNode=d;const g=(id)=>document.getElementById(id);g('taskName').value=d.name||'';g('responsible').value=d.responsible||'';g('status').value=d.status||'Not Started';g('deadline').value=d.deadline||'';g('priority').value=d.priority||'Normal';populateTaskTable(d.actionDescription||'');g('nodeColor').value=d.color||'';document.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('selected-swatch'));if(d.color){const sS=document.querySelector(`.color-swatch[data-color='${d.color}']`);if(sS)sS.classList.add('selected-swatch');}g('modal').style.display='block';};
Â  function saveToFile(){try{data.flowchartName=document.getElementById('flowchartNameInput').value||"Untitled Flowchart";const expD={flowchartName:data.flowchartName,nodes:data.nodes.map(n=>({id:n.id,name:n.name,status:n.status,responsible:n.responsible,deadline:n.deadline,priority:n.priority,actionDescription:n.actionDescription,color:n.color,x:n.x,y:n.y,fx:n.fx,fy:n.fy})),links:data.links},dS=JSON.stringify(expD,null,2),blb=new Blob([dS],{type:'application/json'}),url=URL.createObjectURL(blb),a=document.createElement('a');a.href=url;a.download=(expD.flowchartName.replace(/[^a-z0-9]/gi,'_').toLowerCase()||'flowchart')+'.json';document.body.appendChild(a);a.click();setTimeout(()=>{try{document.body.removeChild(a);URL.revokeObjectURL(url);}catch(rE){console.error("Revoke URL error:",rE);}},100);}catch(e){console.error("Save file error:",e);alert("Error saving.");}};
Â  function loadFromFile(f){if(!f){alert('No file.');return;}const r=new FileReader();r.onload=(e)=>{try{const fD=JSON.parse(e.target.result);if(fD&&typeof fD==='object'&&Array.isArray(fD.nodes)){data.flowchartName=fD.flowchartName||"Untitled";document.getElementById('flowchartNameInput').value=data.flowchartName;data.nodes=fD.nodes.map(n=>({...n,x:n.x,y:n.y,fx:n.fx!==undefined?n.fx:n.x,fy:n.fy!==undefined?n.fy:n.y}));data.links=Array.isArray(fD.links)?fD.links:[];document.getElementById('fileNameDisplay').innerText=`Loaded: ${f.name}`;document.getElementById('fileNameDisplay').title=`Loaded: ${f.name}`;update();}else alert('Invalid format.');}catch(err){alert('Parse error.');console.error("Load file error:",err);}};r.onerror=()=>alert('Read error.');r.readAsText(f);};
Â  function loadTemplate(tmpl){data.flowchartName=tmpl.charAt(0).toUpperCase()+tmpl.slice(1)+" Template";document.getElementById('flowchartNameInput').value=data.flowchartName;data.links=[];switch(tmpl){case 'prototype':data.nodes=[{id:'1',name:'Design System Setup and Component Library Integration',status:'Completed',priority:'High',actionDescription:'[]',color:'#2ecc71'},{id:'2',name:'User Authentication and Profile Management Development',status:'In Progress',priority:'Normal',actionDescription:'[]',color:'#f1c40f'},{id:'3',name:'Real-time Collaboration Feature Testing and Debugging',status:'Not Started',priority:'Low',actionDescription:'[]',color:'#e74c3c'}];break;case 'vendor':data.nodes=[{id:'1',name:'Identify Potential Software Vendors and Compile Shortlist',status:'Completed',priority:'High',actionDescription:'[]',color:'#2ecc71'},{id:'2',name:'Conduct Vendor Outreach, Schedule Demos, and Collect RFPs',status:'In Progress',priority:'Normal',actionDescription:'[]',color:'#f1c40f'},{id:'3',name:'Evaluate Proposals, Negotiate Terms, and Select Final Vendor',status:'Not Started',priority:'Low',actionDescription:'[]',color:'#e74c3c'}];break;case 'marketing':data.nodes=[{id:'1',name:'Comprehensive Market Research and Competitor Analysis',status:'Completed',priority:'High',actionDescription:'[]',color:'#2ecc71'},{id:'2',name:'Marketing Campaign Strategy, Goal Setting, and Content Calendar Development',status:'In Progress',priority:'Normal',actionDescription:'[]',color:'#f1c40f'},{id:'3',name:'Campaign Asset Creation, Platform Setup, and Official Launch Execution',status:'Not Started',priority:'Low',actionDescription:'[]',color:'#e74c3c'}];break;default:data.nodes=[{id:'root-1',name:'Start New Project Here',status:'Not Started',priority:'Normal',actionDescription:'[]',color:'#3498db',x:300,y:150,fx:300,fy:150}];data.flowchartName="New Flowchart";document.getElementById('flowchartNameInput').value=data.flowchartName;}data.nodes.forEach(n=>{n.fx=null;n.fy=null;});placeNodesDiagonally();update();};
Â Â 
Â  document.addEventListener('DOMContentLoaded',()=>{try{initD3();const g=(id)=>document.getElementById(id);
Â  Â  if(g('aiAssistantBtn'))g('aiAssistantBtn').onclick=openAIAssistant;
Â  Â  if(g('nodeSizeIncreaseBtn'))g('nodeSizeIncreaseBtn').onclick=()=>{if(currentNodeSizeFactor<MAX_NODE_SIZE_FACTOR){currentNodeSizeFactor=parseFloat((currentNodeSizeFactor+NODE_SIZE_STEP).toFixed(2));updateNodeSizes();}};
Â  Â  if(g('nodeSizeDecreaseBtn'))g('nodeSizeDecreaseBtn').onclick=()=>{if(currentNodeSizeFactor>MIN_NODE_SIZE_FACTOR){currentNodeSizeFactor=parseFloat((currentNodeSizeFactor-NODE_SIZE_STEP).toFixed(2));updateNodeSizes();}};
Â  Â  document.querySelectorAll('.color-swatch').forEach(s=>s.addEventListener('click',()=>{document.querySelectorAll('.color-swatch').forEach(x=>x.classList.remove('selected-swatch'));s.classList.add('selected-swatch');g('nodeColor').value=s.dataset.color;}));
Â  Â  if(g('templateBtn'))g('templateBtn').onclick=()=>g('templateModal').style.display='block';
Â  Â  document.querySelectorAll('.template-btn').forEach(b=>b.onclick=(e)=>{loadTemplate(e.target.dataset.template);g('templateModal').style.display='none';});
Â  Â  if(g('addNodeBtn'))g('addNodeBtn').onclick=(e)=>{e.preventDefault();const nN=createNode(selectedNode);if(nN){selectedNode=nN;nodeClick({stopPropagation:()=>{}},nN);}};
Â  Â Â 
Â  Â  const saveButton = document.getElementById('saveBtn');Â 
Â  Â  if (saveButton) saveButton.onclick = saveToFile;

Â  Â  if(g('uploadBtn')&&g('fileInput')){g('uploadBtn').onclick=()=>g('fileInput').click();g('fileInput').onchange=(e)=>{if(e.target.files.length>0)loadFromFile(e.target.files[0]);}};
Â  Â Â 
Â  Â  const userGuideBtn = g('userGuideBtn');
Â  Â  const userGuideModal = g('userGuideModal');
Â  Â  const closeUserGuideModalBtn = g('closeUserGuideModal');
Â  Â  if(userGuideBtn && userGuideModal && closeUserGuideModalBtn) {
Â  Â  Â  Â  userGuideBtn.onclick = () => userGuideModal.style.display = 'block';
Â  Â  Â  Â  closeUserGuideModalBtn.onclick = () => userGuideModal.style.display = 'none';
Â  Â  }

Â  Â  document.querySelectorAll('.close-button').forEach(b=>{ if(b.id !== 'closeUserGuideModal') { b.onclick=(e)=>{e.stopPropagation();b.closest('.modal').style.display='none';}}});
Â  Â  window.onclick=(e)=>{if(e.target.classList.contains('modal'))e.target.style.display='none';};
Â  Â  if(g('taskForm'))g('taskForm').onsubmit=(e)=>{e.preventDefault();if(selectedNode){let tsks=[];document.querySelectorAll('#taskTable tbody tr').forEach(r=>{let chk=r.querySelector('input[type="checkbox"]'),txt=r.querySelector('textarea.task-detail-textarea');if(txt&&txt.value.trim()!=="")tsks.push({completed:chk.checked,task:txt.value.trim()});});Object.assign(selectedNode,{name:g('taskName').value,responsible:g('responsible').value,status:g('status').value,deadline:g('deadline').value,priority:g('priority').value,actionDescription:JSON.stringify(tsks),color:g('nodeColor').value||null});selectedNode.fx=selectedNode.x;selectedNode.fy=selectedNode.y;update();}g('modal').style.display='none';};
Â  Â  if(g('addTaskRowBtn'))g('addTaskRowBtn').addEventListener('click',()=>addTaskRow({}));
Â  Â  if(g('deleteTaskBtn'))g('deleteTaskBtn').addEventListener('click',()=>{let sR=document.querySelector('#taskTable tbody tr.selectedTaskRow');if(sR)sR.remove();g('taskTextPopup').style.display='none';});
Â  Â  if(g('deleteNodeBtn'))g('deleteNodeBtn').addEventListener('click',()=>{if(selectedNode&&confirm("Delete node?")){data.nodes=data.nodes.filter(n=>n.id!==selectedNode.id);data.links=data.links.filter(l=>(l.source.id||l.source)!==selectedNode.id&&(l.target.id||l.target)!==selectedNode.id);selectedNode=null;update();g('modal').style.display='none';}});
Â  Â  if(g('flowchartNameInput'))g('flowchartNameInput').addEventListener('input',function(){data.flowchartName=this.value||"Untitled";});
Â  Â  if(data.nodes.length===0)loadTemplate('prototype');else update();}catch(dE){console.error("DOMContentLoaded error:",dE);}});
Â Â 
Â  function createNode(pN){const nId=`node-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;let iX,iY;const vB=svg.attr('viewBox').split(' '),vW=parseFloat(vB[2]),vH=parseFloat(vB[3]),cSD=BASE_NODE_DIMENSION*currentNodeSizeFactor;if(pN&&typeof pN.x==='number'&&typeof pN.y==='number'){iX=pN.x+(Math.random()*100-50);iY=pN.y+(cSD*0.9)+(Math.random()*20-10);}else{iX=vW/2+(Math.random()*200-100);iY=vH/3+(Math.random()*100-50);}iX=Math.max(cSD/2,Math.min(iX,vW-cSD/2));iY=Math.max(cSD/2,Math.min(iY,vH-cSD/2));const nN={id:nId,name:'New Task Node',status:'Not Started',responsible:'',deadline:'',priority:'Normal',actionDescription:'[]',color:null,x:iX,y:iY,fx:iX,fy:iY};data.nodes.push(nN);update();return nN;}
Â  function updateNodeSizes(){if(!simulation)return;const sD=BASE_NODE_DIMENSION*currentNodeSizeFactor;simulation.force('collide').radius((sD*0.55)+25);simulation.force('charge').strength(-1800*(sD/160));update();simulation.alpha(0.3).restart();};
Â Â 
Â  function update(){
Â  Â  if(!svg||!simulation){console.error("D3 not init for update");return;}
Â  Â  if(mainZoomGroup){const lg=mainZoomGroup.select(".links");if(lg&&!lg.empty())lg.selectAll('*').remove();}
Â  Â  if(simulation.force("link"))simulation.force("link",null);

Â  Â  const currentScaledDimension = BASE_NODE_DIMENSION * currentNodeSizeFactor;
Â  Â  const nodeHeight = currentScaledDimension * 0.8;Â 
Â  Â Â 
Â  Â  const baseNodeNameFontSizePx = 14;Â 
Â  Â  const basePillFontSizePx = 12;Â 
Â  Â Â 
Â  Â  const nds=nodeGroup.selectAll('g.node-group').data(data.nodes,d=>d.id);
Â  Â  nds.exit().remove();
Â  Â  const nE=nds.enter().append('g').attr('class','node-group')Â 
Â  Â  Â  .call(d3.drag().on('start',dragStart).on('drag',dragging).on('end',dragEnd))
Â  Â  Â  .on('click',nodeClick);

Â  Â  nE.append('foreignObject')
Â  Â  Â  .attr('class', 'flowchart-node-html-wrapper')
Â  Â  Â  .append('xhtml:div')Â 
Â  Â  Â  Â  .attr('class', 'flowchart-node-html');
Â  Â  Â  Â Â 
Â  Â  const allNds=nE.merge(nds);

Â  Â  allNds.select('foreignObject')
Â  Â  Â  .attr('width', currentScaledDimension)
Â  Â  Â  .attr('height', nodeHeight)
Â  Â  Â  .attr('x', -currentScaledDimension / 2)
Â  Â  Â  .attr('y', -nodeHeight / 2);

Â  Â  allNds.select('.flowchart-node-html')
Â  Â  Â  .each(function(d) {
Â  Â  Â  Â  const nodeOuterDiv = d3.select(this);
Â  Â  Â  Â  const nodeFillOpacity = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--node-fill-opacity').trim() || '0.7');
Â  Â  Â  Â  const baseColorHex = d.color ? d.color : getStatusColor(d.status);
Â  Â  Â  Â  nodeOuterDiv.style('background-color', hexToRgba(baseColorHex, nodeFillOpacity));

Â  Â  Â  Â  let pillDiv = nodeOuterDiv.select('.task-count-pill-html');
Â  Â  Â  Â  if (pillDiv.empty()) pillDiv = nodeOuterDiv.append('div').attr('class', 'task-count-pill-html');
Â  Â  Â  Â Â 
Â  Â  Â  Â  let nameDiv = nodeOuterDiv.select('.node-name-html');
Â  Â  Â  Â  if (nameDiv.empty()) nameDiv = nodeOuterDiv.append('div').attr('class', 'node-name-html');
Â  Â  Â  Â Â 
Â  Â  Â  Â  nameDiv.text(d.name || '')
Â  Â  Â  Â  Â  Â  Â  Â .style('font-size', `${Math.max(10, baseNodeNameFontSizePx * currentNodeSizeFactor)}px`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  let tasks=[];
Â  Â  Â  Â  if(d.actionDescription){try{const p=JSON.parse(d.actionDescription);if(Array.isArray(p))tasks=p;}catch(e){}}
Â  Â  Â  Â  const compC=tasks.filter(t=>t.completed).length,totC=tasks.length;
Â  Â  Â  Â  if(totC > 0) {
Â  Â  Â  Â  Â  pillDiv.text(`âœ“ ${compC}/${totC}`)
Â  Â  Â  Â  Â  Â  Â  Â  Â .style('display', 'block')
Â  Â  Â  Â  Â  Â  Â  Â  Â .style('font-size', `${Math.max(9, basePillFontSizePx * currentNodeSizeFactor)}px`);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  pillDiv.style('display', 'none');
Â  Â  Â  Â  }

        // --- START: Added JavaScript for Priority Indicator ---
        let priorityIndicatorDiv = nodeOuterDiv.select('.priority-indicator');
        if (priorityIndicatorDiv.empty()) {
            priorityIndicatorDiv = nodeOuterDiv.append('div').attr('class', 'priority-indicator');
        }
        priorityIndicatorDiv.html(''); // Clear previous dots to prevent duplication on updates

        const priority = d.priority || 'Normal'; // Default to Normal if priority is not set
        let activeDots = 0;
        switch (priority.toLowerCase()) { // Use toLowerCase for case-insensitive matching
            case 'low':
                activeDots = 1;
                break;
            case 'normal':
                activeDots = 2;
                break;
            case 'high':
                activeDots = 3;
                break;
            default:
                activeDots = 2; // Fallback to normal if unknown value
        }

        for (let i = 0; i < 3; i++) {
            priorityIndicatorDiv.append('div')
                .attr('class', i < activeDots ? 'priority-dot priority-dot-active' : 'priority-dot priority-dot-inactive');
        }
        // --- END: Added JavaScript for Priority Indicator ---
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  simulation.nodes(data.nodes).on('tick',()=>allNds.attr('transform',d=>`translate(${d.x||0},${d.y||0})`));
Â  Â  simulation.alpha(0.3).restart();
Â  };
Â  function getStatusColor(s){switch(s){case 'Not Started':return '#e74c3c';case 'In Progress':return '#f1c40f';case 'Completed':return '#2ecc71';default:return '#3498db';}};
Â  function dragStart(ev,d){if(!ev.active)simulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y;}
Â  function dragging(ev,d){d.fx=ev.x;d.fy=ev.y;}
Â  function dragEnd(ev,d){if(!ev.active)simulation.alphaTarget(0);};
</script>
</body>
</html>
