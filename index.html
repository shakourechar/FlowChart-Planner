<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>FlowChart Manager</title>

Â  <link
Â  Â  rel="icon"
Â  Â  type="image/png"
Â  Â  href="https://static.wixstatic.com/media/c3283f_a3e1ec47496f42f7be617a2cd7a7bc9e~mv2.png"
Â  />

Â  <link
Â  Â  rel="stylesheet"
Â  Â  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"
Â  />

Â  <style>
Â  Â  :root {
Â  Â  Â  --bg-primary: linear-gradient(135deg, #939ef5 0%, #9e76d6 100%);
Â  Â  Â  --header-fixed-bg: #20232a;
Â  Â  Â  --header-glass-border: rgba(255, 255, 255, 0.1);
Â  Â  Â  --text-on-header: white;
Â  Â  Â  --button-bg: rgba(255, 255, 255, 0.25);
Â  Â  Â  --button-text: var(--text-on-header);
Â  Â  Â  --button-hover-bg: rgba(255, 255, 255, 0.4);
Â  Â  Â  --backdrop-blur: 10px;
Â  Â  Â  --input-bg: rgba(255, 255, 255, 0.2);
Â  Â  Â  --input-border: rgba(200, 200, 220, 0.4);
Â  Â  Â  --input-text: #1c1c1e;
Â  Â  Â  --glass-border: rgba(200, 200, 220, 0.4);
Â  Â  Â  --modal-bg: rgba(255, 255, 255, 0.3);
Â  Â  Â  --modal-text: #1c1c1e;
Â  Â  Â  --close-button-color: rgba(0, 0, 0, 0.5);
Â  Â  Â  --close-button-hover-color: #000;
Â  Â  Â  --flowchart-container-bg: rgba(255, 255, 255, 0.15);
Â  Â  Â  --flowchart-container-border: rgba(200, 200, 220, 0.3);
Â  Â  Â  --node-text-fill: var(--text-on-glass-light-bg, #1c1c1e);
Â  Â  Â  --node-fill-opacity: 0.55;
Â  Â  Â  --task-count-rect-bg: rgba(44, 62, 80, 0.75);
Â  Â  Â  --task-count-text-fill: white;
Â  Â  Â  --task-count-border: rgba(255, 255, 255, 0.2);
Â  Â  Â  --modal-strong-shadow: 0 15px 45px rgba(0, 0, 0, 0.15);
Â  Â  Â  --link-color: #555; /* light-mode connector color */
Â  Â  Â  --link-selected-color: #e74c3c;
Â  Â  }

Â  Â  body.dark-mode {
Â  Â  Â  --bg-primary: linear-gradient(135deg, #101020 0%, #0c1428 50%, #08203f 100%);
Â  Â  Â  --text-on-header: #e0e0e0;
Â  Â  Â  --button-bg: rgba(255, 255, 255, 0.12);
Â  Â  Â  --button-text: #e0e0e0;
Â  Â  Â  --button-hover-bg: rgba(255, 255, 255, 0.22);
Â  Â  Â  --input-bg: rgba(255, 255, 255, 0.1);
Â  Â  Â  --input-border: rgba(255, 255, 255, 0.2);
Â  Â  Â  --input-text: #e0e0e0;
Â  Â  Â  --glass-border: rgba(255, 255, 255, 0.15);
Â  Â  Â  --modal-bg: rgba(25, 30, 45, 0.5);
Â  Â  Â  --modal-text: #e0e0e0;
Â  Â  Â  --flowchart-container-bg: rgba(10, 10, 20, 0.1);
Â  Â  Â  --flowchart-container-border: rgba(255, 255, 255, 0.1);
Â  Â  Â  --modal-strong-shadow: 0 15px 45px rgba(0, 0, 0, 0.4);
Â  Â  Â  --link-color: #aaa; /* dark-mode connector color */
Â  Â  Â  --link-selected-color: #ff5252;
Â  Â  }

Â  Â  * {
Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
Â  Â  Â  background: var(--bg-primary);
Â  Â  Â  color: #333;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  transition: background 0.5s ease;
Â  Â  Â  position: relative;
Â  Â  Â  overflow-x: hidden;
Â  Â  }
Â  Â  body::before {
Â  Â  Â  content: '';
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  right: 0;
Â  Â  Â  bottom: 0;
Â  Â  Â  background: var(--bg-primary);
Â  Â  Â  z-index: -1;
Â  Â  Â  transition: background 0.5s ease;
Â  Â  }

Â  Â  /* â”€â”€â”€ HEADER & NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
Â  Â  header {
Â  Â  Â  background: var(--header-fixed-bg);
Â  Â  Â  backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  -webkit-backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  border-bottom: 1px solid var(--header-glass-border);
Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
Â  Â  Â  color: var(--text-on-header);
Â  Â  Â  padding: 1rem 1.5rem;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  header h1 {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  margin: 0;
Â  Â  Â  font-size: 1.75rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: var(--text-on-header);
Â  Â  }

Â  Â  #headerLogo {
Â  Â  Â  width: 32px;
Â  Â  Â  height: 32px;
Â  Â  Â  margin-right: 0.75rem;
Â  Â  }

Â  Â  header h1 input#flowchartNameInput {
Â  Â  Â  margin-left: 1rem;
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  padding: 0.5rem 1rem;
Â  Â  Â  border: 1px solid var(--input-border);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  background: var(--input-bg);
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  Â  -webkit-backdrop-filter: blur(6px);
Â  Â  Â  color: var(--input-text);
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  font-weight: 400;
Â  Â  }
Â  Â  header h1 input#flowchartNameInput:focus {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: var(--glass-border);
Â  Â  Â  box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  nav {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  nav button,
Â  Â  #themeToggleBtn {
Â  Â  Â  background: var(--button-bg);
Â  Â  Â  backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  -webkit-backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  border: 1px solid var(--header-glass-border);
Â  Â  Â  color: var(--button-text);
Â  Â  Â  padding: 0.5rem;
Â  Â  Â  width: 2.5rem;
Â  Â  Â  height: 2.5rem;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  position: relative;
Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â  nav button::before,
Â  Â  #themeToggleBtn::before {
Â  Â  Â  content: '';
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: -100%;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
Â  Â  Â  transition: left 0.5s ease;
Â  Â  }
Â  Â  nav button:hover::before,
Â  Â  #themeToggleBtn:hover::before {
Â  Â  Â  left: 100%;
Â  Â  }
Â  Â  nav button:hover,
Â  Â  #themeToggleBtn:hover {
Â  Â  Â  background: var(--button-hover-bg);
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
Â  Â  }
Â  Â  nav button:active,
Â  Â  #themeToggleBtn:active,
Â  Â  nav button.active {
Â  Â  Â  transform: translateY(0);
Â  Â  Â  background: var(--button-hover-bg);
Â  Â  Â  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
Â  Â  }

Â  Â  #fileNameDisplay {
Â  Â  Â  margin-left: 1rem;
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  color: var(--text-on-header);
Â  Â  Â  white-space: nowrap;
Â  Â  Â  overflow: hidden;
Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  max-width: 120px;
Â  Â  }

Â  Â  /* START: CSS FOR TOOLTIP */
Â  Â  #tooltip {
Â  Â  Â  position: fixed;
Â  Â  Â  background-color: var(--header-fixed-bg);
Â  Â  Â  color: var(--text-on-header);
Â  Â  Â  padding: 8px 14px;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  font-weight: 500;
Â  Â  Â  z-index: 10001; /* Higher than modals */
Â  Â  Â  pointer-events: none; /* Prevents tooltip from interfering with mouse events */
Â  Â  Â  visibility: hidden;
Â  Â  Â  opacity: 0;
Â  Â  Â  white-space: nowrap;
Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
Â  Â  Â  border: 1px solid var(--header-glass-border);
Â  Â  Â  transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
Â  Â  Â  transform: translateX(-50%) translateY(10px); /* Start below and centered */
Â  Â  }

Â  Â  #tooltip.visible {
Â  Â  Â  visibility: visible;
Â  Â  Â  opacity: 1;
Â  Â  Â  transform: translateX(-50%) translateY(0); /* Animate to final position */
Â  Â  }
Â  Â  /* END: CSS FOR TOOLTIP */

Â  Â  @media (max-width: 768px) {
Â  Â  Â  nav {
Â  Â  Â  Â  gap: 0.3rem;
Â  Â  Â  }
Â  Â  Â  nav button,
Â  Â  Â  #themeToggleBtn {
Â  Â  Â  Â  width: 2.2rem;
Â  Â  Â  Â  height: 2.2rem;
Â  Â  Â  Â  font-size: 1rem;
Â  Â  Â  }
Â  Â  }
Â  Â  @media (max-width: 480px) {
Â  Â  Â  header {
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  gap: 0.75rem;
Â  Â  Â  }
Â  Â  Â  header h1 {
Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  }
Â  Â  Â  nav {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  gap: 0.25rem;
Â  Â  Â  }
Â  Â  Â  nav button,
Â  Â  Â  #themeToggleBtn {
Â  Â  Â  Â  width: 2rem;
Â  Â  Â  Â  height: 2rem;
Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  }
Â  Â  Â  #fileNameDisplay {
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  }

Â  Â  /* â”€â”€â”€ FLOWCHART CONTAINER, LEGEND & BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
Â  Â  #colorLegendDisplay {
Â  Â  Â  margin: 0.5rem 1rem 0rem 1rem;
Â  Â  Â  padding: 0.5rem 1rem;
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  -webkit-backdrop-filter: blur(10px);
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 1.25rem;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  color: var(--text-on-header);
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  visibility: hidden;
Â  Â  Â  opacity: 0;
Â  Â  Â  max-height: 0;
Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â  #colorLegendDisplay.visible {
Â  Â  Â  visibility: visible;
Â  Â  Â  opacity: 1;
Â  Â  Â  max-height: 100px; /* Animate height */
Â  Â  }
Â  Â  .legend-item {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  }
Â  Â  .legend-color-box {
Â  Â  Â  width: 16px;
Â  Â  Â  height: 16px;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.2);
Â  Â  Â  flex-shrink: 0;
Â  Â  }

Â  Â  #flowchartContainer {
Â  Â  Â  width: calc(100% - 2rem);
Â  Â  Â  flex-grow: 1;
Â  Â  Â  border: 1px solid var(--flowchart-container-border);
Â  Â  Â  background: var(--flowchart-container-bg);
Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  -webkit-backdrop-filter: blur(5px);
Â  Â  Â  overflow: hidden;
Â  Â  Â  position: relative;
Â  Â  Â  margin: 1rem;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
Â  Â  Â  transition: background 0.3s ease, border-color 0.3s ease;
Â  Â  }
Â  Â  #flowchart {
Â  Â  Â  display: block;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  }
Â  Â Â 
Â  Â  line.link {
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: stroke 0.3s ease, stroke-width 0.3s ease;
Â  Â  }
Â  Â  line.link.selected {
Â  Â  Â  Â  stroke: var(--link-selected-color) !important;
Â  Â  Â  Â  stroke-width: 4px;
Â  Â  Â  Â  stroke-dasharray: 5, 5;
Â  Â  }

Â  Â  #banner-container {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  left: 10px;
Â  Â  Â  width: 35%;
Â  Â  Â  max-width: 420px;
Â  Â  Â  aspect-ratio: 1500 / 625;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  overflow: hidden;
Â  Â  Â  background: transparent;
Â  Â  Â  z-index: 50;
Â  Â  }
Â  Â  #banner-container iframe {
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  border: none;
Â  Â  Â  background: transparent;
Â  Â  }

Â  Â  /* â”€â”€â”€ MODALS & GENERIC STYLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
Â  Â  .modal {
Â  Â  Â  display: none;
Â  Â  Â  position: fixed;
Â  Â  Â  z-index: 1000;
Â  Â  Â  left: 0;
Â  Â  Â  top: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.4);
Â  Â  Â  backdrop-filter: blur(8px);
Â  Â  Â  -webkit-backdrop-filter: blur(8px);
Â  Â  Â  padding-top: 50px;
Â  Â  Â  overflow-y: auto;
Â  Â  }
Â  Â  .modal-content {
Â  Â  Â  background: var(--modal-bg);
Â  Â  Â  backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  -webkit-backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  Â  color: var(--modal-text);
Â  Â  Â  margin: 20px auto;
Â  Â  Â  padding: 2rem;
Â  Â  Â  width: 90%;
Â  Â  Â  max-width: 750px;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  max-height: calc(100vh - 100px);
Â  Â  Â  border-radius: 20px;
Â  Â  Â  position: relative;
Â  Â  Â  box-shadow: var(--modal-strong-shadow);
Â  Â  Â  transition: background 0.3s ease, border-color 0.3s ease;
Â  Â  }
Â  Â  #deleteLinkModal .modal-content, #colorLegendModal .modal-content {
Â  Â  Â  max-width: 550px;
Â  Â  }
Â  Â Â 
Â  Â  .close-button {
Â  Â  Â  position: absolute;
Â  Â  Â  right: 15px;
Â  Â  Â  top: 15px;
Â  Â  Â  font-size: 24px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  color: var(--close-button-color);
Â  Â  Â  width: 32px;
Â  Â  Â  height: 32px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  z-index: 10;
Â  Â  }
Â  Â  .close-button:hover {
Â  Â  Â  color: var(--close-button-hover-color);
Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  Â  transform: scale(1.1);
Â  Â  }

Â  Â  form {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 1rem;
Â  Â  }
Â  Â  input,
Â  Â  select,
Â  Â  textarea {
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  border: 1px solid var(--input-border);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  font-size: 1em;
Â  Â  Â  background: var(--input-bg);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  -webkit-backdrop-filter: blur(10px);
Â  Â  Â  color: var(--input-text);
Â  Â  Â  font-family: 'Inter', 'Segoe UI', sans-serif;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  input:focus,
Â  Â  select:focus,
Â  Â  textarea:focus {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: var(--glass-border);
Â  Â  Â  box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
Â  Â  Â  transform: translateY(-1px);
Â  Â  }
Â  Â  textarea {
Â  Â  Â  resize: vertical;
Â  Â  Â  min-height: 80px;
Â  Â  }
Â  Â  #taskName {
Â  Â  Â  width: 100%;
Â  Â  }
Â  Â Â 
Â  Â  .modal-btn {
Â  Â  Â  Â  background: rgba(255, 255, 255, 0.15);
Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.2);
Â  Â  Â  Â  color: var(--modal-text);
Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  Â  -webkit-backdrop-filter: blur(5px);
Â  Â  }
Â  Â  .modal-btn:hover {
Â  Â  Â  Â  background: rgba(255, 255, 255, 0.25);
Â  Â  Â  Â  border-color: rgba(255, 255, 255, 0.3);
Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
Â  Â  }
Â  Â  .modal-btn:active {
Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  box-shadow: none;
Â  Â  }
Â  Â  .modal-btn.danger {
Â  Â  Â  Â  background-color: rgba(231, 76, 60, 0.5);
Â  Â  }
Â  Â  .modal-btn.danger:hover {
Â  Â  Â  Â  background-color: rgba(231, 76, 60, 0.7);
Â  Â  }

Â  Â  /* START: CSS FOR COLOR LEGEND MODAL */
Â  Â  .color-legend-entry {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 1rem;
Â  Â  Â  margin-bottom: 0.75rem;
Â  Â  }
Â  Â  .color-legend-swatch {
Â  Â  Â  width: 32px;
Â  Â  Â  height: 32px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  flex-shrink: 0;
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  }
Â  Â  .color-legend-input {
Â  Â  Â  flex-grow: 1;
Â  Â  Â  padding: 10px 14px;
Â  Â  }
Â  Â  /* END: CSS FOR COLOR LEGEND MODAL */

Â  Â  .flowchart-node-html-wrapper {
Â  Â  Â  overflow: visible;
Â  Â  }

Â  Â  .flowchart-node-html {
Â  Â  Â  backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  -webkit-backdrop-filter: blur(var(--backdrop-blur));
Â  Â  Â  border: 1px solid var(--glass-border);
Â  Â  Â  box-shadow: var(--modal-strong-shadow);
Â  Â  Â  border-radius: 18px;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  padding: 20px;
Â  Â  Â  padding-top: 40px;
Â  Â  Â  padding-bottom: 24px;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  color: var(--node-text-fill);
Â  Â  Â  text-align: center;
Â  Â  Â  cursor: move;
Â  Â  Â  position: relative;
Â  Â  Â  overflow: hidden;
Â  Â  Â  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
Â  Â  }

Â  Â  .flowchart-node-html .priority-indicator {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 12px;
Â  Â  Â  right: 12px;
Â  Â  Â  display: flex;
Â  Â  Â  gap: 2px;
Â  Â  Â  font-size: 0.8em;
Â  Â  Â  line-height: 1;
Â  Â  }

Â  Â  .node-name-html {
Â  Â  Â  font-weight: 500;
Â  Â  Â  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
Â  Â  Â  word-break: break-word;
Â  Â  Â  max-width: 100%;
Â  Â  Â  width: 100%;
Â  Â  Â  overflow: visible;
Â  Â  }
Â  Â  body.dark-mode .node-name-html {
Â  Â  Â  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.35);
Â  Â  }

Â  Â  .task-count-pill-html {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 8px;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  background: var(--task-count-rect-bg);
Â  Â  Â  color: var(--task-count-text-fill);
Â  Â  Â  padding: 5px 12px;
Â  Â  Â  border-radius: 14px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
Â  Â  Â  border: 1px solid var(--task-count-border);
Â  Â  Â  backdrop-filter: blur(4px);
Â  Â  Â  -webkit-backdrop-filter: blur(4px);
Â  Â  Â  white-space: nowrap;
Â  Â  Â  z-index: 5;
Â  Â  Â  transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
Â  Â  }

Â  Â  #userGuideModal .modal-content ul {
Â  Â  Â  list-style-type: disc;
Â  Â  Â  padding-left: 20px;
Â  Â  }
Â  Â  #userGuideModal .modal-content h2 {
Â  Â  Â  font-size: 1.5em;
Â  Â  Â  margin-bottom: 1em;
Â  Â  }
Â  Â  #userGuideModal .modal-content h3 {
Â  Â  Â  margin-top: 1.5em;
Â  Â  Â  margin-bottom: 0.5em;
Â  Â  Â  font-size: 1.15em;
Â  Â  Â  color: var(--modal-text);
Â  Â  }
Â  Â  #userGuideModal .modal-content li {
Â  Â  Â  margin-bottom: 0.7em;
Â  Â  Â  line-height: 1.6;
Â  Â  }
Â  Â  #userGuideModal .modal-content li strong {
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: var(--modal-text);
Â  Â  }
Â  Â  #userGuideModal .modal-content p {
Â  Â  Â  margin-bottom: 1em;
Â  Â  Â  line-height: 1.6;
Â  Â  }
Â  Â Â 
Â  Â  #shareModal .modal-content {
Â  Â  Â  Â  max-width: 900px;
Â  Â  }
Â  Â  #shareModal iframe {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  height: 70vh;
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  border-radius: 12px;
Â  Â  }

Â  Â  .action-buttons {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: flex-end;
Â  Â  Â  gap: 15px;
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â  .color-panel {
Â  Â  Â  display: flex;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  gap: 10px;
Â  Â  Â  margin-top: 12px;
Â  Â  Â  margin-bottom: 12px;
Â  Â  }
Â  Â  .color-swatch {
Â  Â  Â  width: 32px;
Â  Â  Â  height: 32px;
Â  Â  Â  border: 2px solid var(--glass-border);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  -webkit-backdrop-filter: blur(10px);
Â  Â  }
Â  Â  .color-swatch:hover {
Â  Â  Â  transform: scale(1.15) translateY(-2px);
Â  Â  Â  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
Â  Â  }
Â  Â  .selected-swatch {
Â  Â  Â  outline: 3px solid var(--selected-swatch-outline, #1c1c1e);
Â  Â  Â  outline-offset: 3px;
Â  Â  Â  transform: scale(1.1);
Â  Â  }

Â  Â  .selectedTaskRow {
Â  Â  Â  border: 2px solid var(--selected-row-border, rgba(52, 152, 219, 0.8));
Â  Â  Â  background: var(--selected-row-bg, rgba(200, 210, 225, 0.3));
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  -webkit-backdrop-filter: blur(10px);
Â  Â  Â  border-radius: 8px;
Â  Â  }

Â  Â  #taskTable {
Â  Â  Â  width: 100%;
Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  border-collapse: collapse;
Â  Â  }
Â  Â  #taskTable th {
Â  Â  Â  text-align: left;
Â  Â  Â  padding-bottom: 8px;
Â  Â  Â  border-bottom: 2px solid var(--table-header-separator, rgba(0, 0, 0, 0.2));
Â  Â  Â  color: var(--th-text-color, #1c1c1e);
Â  Â  Â  font-weight: 600;
Â  Â  }
Â  Â  #taskTable td {
Â  Â  Â  padding-top: 8px;
Â  Â  }

Â  Â  .task-detail-textarea {
Â  Â  Â  width: 100%;
Â  Â  Â  resize: vertical;
Â  Â  Â  border: 1px solid var(--input-border);
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  background: var(--input-bg);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  -webkit-backdrop-filter: blur(10px);
Â  Â  Â  color: var(--input-text);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 0.9em;
Â  Â  Â  min-height: 3em;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â  .task-detail-textarea:focus {
Â  Â  Â  border-color: var(--glass-border);
Â  Â  Â  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  @media (max-width: 768px) {
Â  Â  Â  #banner-container {
Â  Â  Â  Â  width: 49%;
Â  Â  Â  Â  max-width: 294px;
Â  Â  Â  Â  aspect-ratio: 1500 / 625;
Â  Â  Â  }
Â  Â  }
Â  Â  @media (max-width: 480px) {
Â  Â  Â  #banner-container {
Â  Â  Â  Â  width: 56%;
Â  Â  Â  Â  max-width: 252px;
Â  Â  Â  Â  aspect-ratio: 1500 / 625;
Â  Â  Â  }
Â  Â  }
Â  </style>

Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>

<body>
Â  <header>
Â  Â  <h1>
Â  Â  Â  <img
Â  Â  Â  Â  src="https://static.wixstatic.com/media/c3283f_a3e1ec47496f42f7be617a2cd7a7bc9e~mv2.png"
Â  Â  Â  Â  alt="Logo"
Â  Â  Â  Â  id="headerLogo"
Â  Â  Â  />
Â  Â  Â  FlowChart Manager
Â  Â  Â  <input
Â  Â  Â  Â  type="text"
Â  Â  Â  Â  id="flowchartNameInput"
Â  Â  Â  Â  placeholder="Enter Flowchart Nameâ€¦"
Â  Â  Â  />
Â  Â  </h1>

Â  Â  <nav>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  id="nodeSizeIncreaseBtn"
Â  Â  Â  Â  aria-label="Node Size +"
Â  Â  Â  Â  title="Increase Node Size"
Â  Â  Â  Â  data-tooltip-text="Increase Node Size"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-plus"></i>
Â  Â  Â  </button>

Â  Â  Â  <button
Â  Â  Â  Â  id="nodeSizeDecreaseBtn"
Â  Â  Â  Â  aria-label="Node Size -"
Â  Â  Â  Â  title="Decrease Node Size"
Â  Â  Â  Â  data-tooltip-text="Decrease Node Size"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-minus"></i>
Â  Â  Â  </button>
Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  id="colorLegendBtn"
Â  Â  Â  Â  aria-label="Color Legend"
Â  Â  Â  Â  title="Color Legend"
Â  Â  Â  Â  data-tooltip-text="Define Color Legend"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-palette"></i>
Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  id="aiAssistantBtn"
Â  Â  Â  Â  aria-label="Flowchart AI Assistant"
Â  Â  Â  Â  title="Flowchart AI Assistant"
Â  Â  Â  Â  data-tooltip-text="AI Assistant"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-lightbulb"></i>
Â  Â  Â  </button>

Â  Â  Â  <button
Â  Â  Â  Â  id="userGuideBtn"
Â  Â  Â  Â  aria-label="User Guide"
Â  Â  Â  Â  title="User Guide"
Â  Â  Â  Â  data-tooltip-text="User Guide"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-book-open"></i>
Â  Â  Â  </button>

Â  Â  Â  <button
Â  Â  Â  Â  id="templateBtn"
Â  Â  Â  Â  aria-label="Templates"
Â  Â  Â  Â  title="Templates"
Â  Â  Â  Â  data-tooltip-text="Load a Template"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-file-alt"></i>
Â  Â  Â  </button>

Â  Â  Â  <button
Â  Â  Â  Â  id="projectDescBtn"
Â  Â  Â  Â  aria-label="Project Description"
Â  Â  Â  Â  title="Project Description"
Â  Â  Â  Â  style="display: none;"
Â  Â  Â  Â  data-tooltip-text="Project Description"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-info-circle"></i>
Â  Â  Â  </button>

Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  id="addConnectorBtn"Â 
Â  Â  Â  Â  aria-label="Add Connector"Â 
Â  Â  Â  Â  title="Add Connector"
Â  Â  Â  Â  data-tooltip-text="Add Connector"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-link"></i>
Â  Â  Â  </button>

Â  Â  Â  <button
Â  Â  Â  Â  id="saveBtn"
Â  Â  Â  Â  aria-label="Save"
Â  Â  Â  Â  title="Save"
Â  Â  Â  Â  data-tooltip-text="Save Flowchart"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-floppy-disk"></i>
Â  Â  Â  </button>
Â  Â  Â Â 
Â  Â  Â  <button
Â  Â  Â  Â  id="shareBtn"
Â  Â  Â  Â  aria-label="Share"
Â  Â  Â  Â  title="Share"
Â  Â  Â  Â  data-tooltip-text="Share"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-share-alt"></i>
Â  Â  Â  </button>

Â  Â  Â  <input
Â  Â  Â  Â  type="file"
Â  Â  Â  Â  id="fileInput"
Â  Â  Â  Â  accept=".json"
Â  Â  Â  Â  style="display: none;"
Â  Â  Â  />
Â  Â  Â  <button
Â  Â  Â  Â  id="uploadBtn"
Â  Â  Â  Â  aria-label="Upload"
Â  Â  Â  Â  title="Upload"
Â  Â  Â  Â  data-tooltip-text="Upload Flowchart"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-upload"></i>
Â  Â  Â  </button>

Â  Â  Â  <div id="fileNameDisplay">No file loaded</div>

Â  Â  Â  <button
Â  Â  Â  Â  id="themeToggleBtn"
Â  Â  Â  Â  aria-label="Toggle theme"
Â  Â  Â  Â  title="Toggle theme"
Â  Â  Â  Â  data-tooltip-text="Toggle Theme"
Â  Â  Â  >
Â  Â  Â  Â  <i class="fas fa-moon"></i>
Â  Â  Â  </button>
Â  Â  Â  Â  Â  </nav>
Â  </header>
Â Â 
Â  Â  <div id="colorLegendDisplay"></div>
Â  Â  <div id="flowchartContainer">
Â  Â  <div id="banner-container">
Â  Â  Â  <iframe
Â  Â  Â  Â  src="https://transcendence.media/SmartWealth-Banner"
Â  Â  Â  Â  allowtransparency="true"
Â  Â  Â  Â  scrolling="no"
Â  Â  Â  Â  frameborder="0"
Â  Â  Â  ></iframe>
Â  Â  </div>
Â  Â  <svg id="flowchart"></svg>
Â  </div>

Â  <div id="modal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeModal">Ã—</span>
Â  Â  Â  <h2>Task Details</h2>
Â  Â  Â  <form id="taskForm">
Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Task Name:
Â  Â  Â  Â  Â  <textarea id="taskName" required></textarea>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Responsible:
Â  Â  Â  Â  Â  <input type="text" id="responsible" required />
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Status:
Â  Â  Â  Â  Â  <select id="status">
Â  Â  Â  Â  Â  Â  <option value="Not Started">Not Started</option>
Â  Â  Â  Â  Â  Â  <option value="In Progress">In Progress</option>
Â  Â  Â  Â  Â  Â  <option value="Completed">Completed</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Deadline:
Â  Â  Â  Â  Â  <input type="date" id="deadline" />
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Priority:
Â  Â  Â  Â  Â  <select id="priority">
Â  Â  Â  Â  Â  Â  <option value="Low">Low</option>
Â  Â  Â  Â  Â  Â  <option value="Normal">Normal</option>
Â  Â  Â  Â  Â  Â  <option value="High">High</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </label>
Â  Â  Â  Â  <label>Action Description (Sub-tasks):</label>
Â  Â  Â  Â  <table id="taskTable">
Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  <th style="width: 30px;">âœ“</th>
Â  Â  Â  Â  Â  Â  Â  <th>Task</th>
Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  Â  <button type="button" id="addTaskRowBtn" class="modal-btn">Add Task</button>
Â  Â  Â  Â  <label>Node Color:</label>
Â  Â  Â  Â  <input type="hidden" id="nodeColor" />
Â  Â  Â  Â  <div class="color-panel">
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="color-swatch"
Â  Â  Â  Â  Â  Â  style="background-color: #e74c3c;"
Â  Â  Â  Â  Â  Â  data-color="#e74c3c"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="color-swatch"
Â  Â  Â  Â  Â  Â  style="background-color: #f1c40f;"
Â  Â  Â  Â  Â  Â  data-color="#f1c40f"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="color-swatch"
Â  Â  Â  Â  Â  Â  style="background-color: #2ecc71;"
Â  Â  Â  Â  Â  Â  data-color="#2ecc71"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="color-swatch"
Â  Â  Â  Â  Â  Â  style="background-color: #3498db;"
Â  Â  Â  Â  Â  Â  data-color="#3498db"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="color-swatch"
Â  Â  Â  Â  Â  Â  style="background-color: #9b59b6;"
Â  Â  Â  Â  Â  Â  data-color="#9b59b6"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  class="color-swatch"
Â  Â  Â  Â  Â  Â  style="background-color: #34495e;"
Â  Â  Â  Â  Â  Â  data-color="#34495e"
Â  Â  Â  Â  Â  ></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="action-buttons">
Â  Â  Â  Â  Â  <button type="submit" class="modal-btn">Save Node</button>
Â  Â  Â  Â  Â  <button type="button" class="modal-btn" id="addNodeBtn">
Â  Â  Â  Â  Â  Â  Add Child Node
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="text-align: center; margin-top: 20px;">
Â  Â  Â  Â  Â  <button type="button" id="deleteNodeBtn" class="modal-btn danger">Delete Node</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </div>
Â  </div>
Â Â 
Â  Â  <div id="colorLegendModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeColorLegendModal">Ã—</span>
Â  Â  Â  <h2>Define Color Legend</h2>
Â  Â  Â  <form id="colorLegendForm">
Â  Â  Â  Â  <div id="colorLegendEntries">
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="action-buttons">
Â  Â  Â  Â  Â  <button type="submit" class="modal-btn">Save Legend</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </div>
Â  </div>
Â  Â  <div id="templateModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeTemplateModal">Ã—</span>
Â  Â  Â  <h2>Select Template</h2>
Â  Â  Â  <div style="display: flex; flex-direction: column; gap: 1rem;">
Â  Â  Â  Â  Â  <button class="modal-btn template-btn" data-template="prototype">
Â  Â  Â  Â  Â  Â  Prototype Development
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button class="modal-btn template-btn" data-template="vendor">
Â  Â  Â  Â  Â  Â  Vendor Outreach
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button class="modal-btn template-btn" data-template="marketing">
Â  Â  Â  Â  Â  Â  Marketing Campaign
Â  Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div id="taskTextPopup" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeTaskPopup">Ã—</span>
Â  Â  Â  <p
Â  Â  Â  Â  id="taskFullText"
Â  Â  Â  Â  style="white-space: pre-wrap; max-height: 60vh; overflow-y: auto;"
Â  Â  Â  ></p>
Â  Â  Â  <button id="deleteTaskBtn" class="modal-btn danger">Delete Task</button>
Â  Â  </div>
Â  </div>

Â  <div id="userGuideModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeUserGuideModal">Ã—</span>
Â  Â  Â  <h2>ğŸ“˜ FlowChart Manager â€“ User Guide</h2>

Â  Â  Â  <h3>ğŸ› ï¸ Interface Controls</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li><b>ğŸ¨ Color Legend</b> â€“ Define what each node color represents. The legend will appear below the header.</li>
Â  Â  Â  Â  <li><b>â†¥ Upload</b> â€“ Import a FlowChart (json) file to continue work or load a new chart.</li>
Â  Â  Â  Â  <li><b>ğŸ’¾ Save</b> â€“ Saving a FlowChart will always create a new file version each time.</li>
Â  Â  Â  Â  <li><b>ğŸ“„ Templates</b> â€“ Start with a ready-made template ğŸ“„ (Prototype, Vendor, or Marketing).</li>
Â  Â  Â  Â  <li><b>+/- Node Size </b> â€“ Resize task nodes for better visibility.</li>
Â  Â  Â  Â  <li><b>ğŸ”— Add Connector</b> - Click to enter 'Connector Mode,' then click two nodes to link them.</li>
Â  Â  Â  Â  <li><b>â›“ï¸â€ğŸ’¥ Delete a Connector</b> - Click directly on a connector line to bring up a confirmation to delete it.</li>
Â  Â  Â  Â  <li>Use your mouse to drag entire Canvas.</li>
Â  Â  Â  Â  <li>Use mouse wheel to further enlarge/shrink nodes.</li>
Â  Â  Â  Â  <li><b>Share</b> â€“ Tell your friends/colleagues about FlowChart!.</li>
Â  Â  Â  </ul>

Â  Â  Â  <h3>ğŸ§© Working with Tasks</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>Click any node to view or edit its details.</li>
Â  Â  Â  Â  <li>To delete a specific sub-task, simply double-click on its text field within the node details popup.</li>
Â  Â  Â  Â  <li>Completing fields like Responsible, Deadline, and Priority helps align your workflow, track progress, and maintain clarity.</li>
Â  Â  Â  </ul>

Â  Â  Â  <h3>ğŸš€ Tips for Effective Use</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>Start with a template if unsureâ€”it gives structure fast.</li>
Â  Â  Â  Â  <li>Organize nodes clockwise or top-down for clear readability.</li>
Â  Â  Â  Â  <li>Save regularly to avoid losing progress.</li>
Â  Â  Â  Â  <li>Use concise task names and clear action descriptions.</li>
Â  Â  Â  Â  <li>Keep Phase nodes separate and use them to group related tasks.</li>
Â  Â  Â  </ul>

Â  Â  Â  <h3><i class="fas fa-lightbulb"></i> GPT FlowChart Assistant</h3>
Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>Click the ğŸ’¡ button to open our FlowChart AI Assistant. </li>
Â  Â  Â  Â  Â  Â  <li>Ask the AI assistant to:
Â  Â  Â  Â  Â  Â  Â  Â  <ul style="margin-top: 0.5em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Analyze and suggest improvements</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Provide insights, summaries, reports</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Update/Add/Delete node titles, deadlines, tasks, etc.</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  </ul>
Â  Â  </div>
Â  </div>

Â  <div id="shareModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeShareModal">Ã—</span>
Â  Â  Â  <h2>Share Flowchart</h2>
Â  Â  Â  <iframeÂ 
Â  Â  Â  Â  src="https://view.genially.com/6845a98ee4504c754b83f421"Â 
Â  Â  Â  Â  allowfullscreen="true"Â 
Â  Â  Â  Â  scrolling="no"Â 
Â  Â  Â  Â  frameborder="0">
Â  Â  Â  </iframe>
Â  Â  </div>
Â  </div>

Â  <div id="projectDescModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  <span class="close-button" id="closeProjectDescModal">Ã—</span>
Â  Â  Â  <h2>Project Description</h2>
Â  Â  Â  <p id="projectSummary"></p>
Â  Â  Â  <p id="projectGeneratedDate"></p>
Â  Â  </div>
Â  </div>
Â Â 
Â  <div id="deleteLinkModal" class="modal">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  <span class="close-button" id="cancelDeleteLinkBtn">Ã—</span>
Â  Â  Â  Â  Â  <h2>Delete Connector</h2>
Â  Â  Â  Â  Â  <p>Are you sure you want to delete this connection?</p>
Â  Â  Â  Â  Â  <div class="action-buttons">
Â  Â  Â  Â  Â  Â  Â  <button id="confirmDeleteLinkBtn" class="modal-btn danger">Delete</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  </div>

Â  Â  <div id="tooltip"></div>
Â  Â  <script>
Â  Â  // --- Theme Toggle Script ---
Â  Â  try {
Â  Â  Â  const themeToggleBtn = document.getElementById('themeToggleBtn');
Â  Â  Â  const currentDocumentBody = document.body;
Â  Â  Â  const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

Â  Â  Â  function applyTheme(theme) {
Â  Â  Â  Â  currentDocumentBody.classList.toggle('dark-mode', theme === 'dark');
Â  Â  Â  }

Â  Â  Â  if (themeToggleBtn && currentDocumentBody && prefersDarkScheme) {
Â  Â  Â  Â  const savedTheme = localStorage.getItem('theme');
Â  Â  Â  Â  applyTheme(savedTheme ? savedTheme : (prefersDarkScheme.matches ? 'dark' : 'light'));

Â  Â  Â  Â  themeToggleBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  const newTheme = currentDocumentBody.classList.contains('dark-mode') ? 'light' : 'dark';
Â  Â  Â  Â  Â  applyTheme(newTheme);
Â  Â  Â  Â  Â  localStorage.setItem('theme', newTheme);
Â  Â  Â  Â  Â  const ico = themeToggleBtn.querySelector('i');
Â  Â  Â  Â  Â  if (newTheme === 'dark') {
Â  Â  Â  Â  Â  Â  ico.className = 'fas fa-sun';
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  ico.className = 'fas fa-moon';
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  prefersDarkScheme.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  if (!localStorage.getItem('theme')) applyTheme(e.matches ? 'dark' : 'light');
Â  Â  Â  Â  });
Â  Â  Â  } else {
Â  Â  Â  Â  console.error('Theme toggle elements missing.');
Â  Â  Â  }
Â  Â  } catch (themeError) {
Â  Â  Â  console.error('Theme script error:', themeError);
Â  Â  }

Â  Â  // --- Main Application Script ---
Â  Â  function openAIAssistant() {
Â  Â  Â  const url =
Â  Â  Â  Â  'https://chatgpt.com/g/g-678c450b02988191b07d47c7a5bd9d4a-flow-chart-assistant';
Â  Â  Â  const sW = window.screen.availWidth,
Â  Â  Â  Â  sH = window.screen.availHeight,
Â  Â  Â  Â  bS = Math.min(sW, sH);
Â  Â  Â  const pW = Math.floor(bS * 0.45),
Â  Â  Â  Â  pH = Math.floor(bS * 0.55),
Â  Â  Â  Â  l = Math.floor((sW - pW) / 2),
Â  Â  Â  Â  t = Math.floor((sH - pH) / 2);
Â  Â  Â  window.open(
Â  Â  Â  Â  url,
Â  Â  Â  Â  'FlowchartAIAssistant',
Â  Â  Â  Â  `width=${pW},height=${pH},left=${l},top=${t},resizable=yes,scrollbars=yes,status=no,location=no,menubar=no,toolbar=no`
Â  Â  Â  );
Â  Â  }

Â  Â  let selectedNode = null,
Â  Â  Â  selectedLink = null,
Â  Â  Â  data = {
Â  Â  Â  Â  flowchartName: 'Untitled Flowchart',
Â  Â  Â  Â  projectDescription: { summary: '', generatedDate: '' },
Â  Â  Â  Â  nodes: [],
Â  Â  Â  Â  links: [],
Â  Â  Â  Â  colorLegends: {} // <-- NEW data property for legends
Â  Â  Â  },
Â  Â  Â  simulation,
Â  Â  Â  svg,
Â  Â  Â  nodeGroup,
Â  Â  Â  linkGroup,
Â  Â  Â  mainZoomGroup;
Â  Â  const BASE_NODE_DIMENSION = 160;
Â  Â  let currentNodeSizeFactor = 1.0;
Â  Â  const MIN_NODE_SIZE_FACTOR = 0.5,
Â  Â  Â  MAX_NODE_SIZE_FACTOR = 1.5,
Â  Â  Â  NODE_SIZE_STEP = 0.1;
Â  Â Â 
Â  Â  const NODE_COLORS = [
Â  Â  Â  '#e74c3c', '#f1c40f', '#2ecc71', '#3498db', '#9b59b6', '#34495e'
Â  Â  ];

Â  Â  let connectorMode = false;
Â  Â  let connectorStartNode = null;

Â  Â  function hexToRgba(hex, alpha = 1) {
Â  Â  Â  if (!hex || typeof hex !== 'string') return `rgba(200,200,200,${alpha})`;
Â  Â  Â  hex = hex.replace('#', '');
Â  Â  Â  let r = 0,
Â  Â  Â  Â  g = 0,
Â  Â  Â  Â  b = 0;
Â  Â  Â  if (hex.length === 3) {
Â  Â  Â  Â  r = parseInt(hex[0] + hex[0], 16);
Â  Â  Â  Â  g = parseInt(hex[1] + hex[1], 16);
Â  Â  Â  Â  b = parseInt(hex[2] + hex[2], 16);
Â  Â  Â  } else if (hex.length === 6) {
Â  Â  Â  Â  r = parseInt(hex.substring(0, 2), 16);
Â  Â  Â  Â  g = parseInt(hex.substring(2, 4), 16);
Â  Â  Â  Â  b = parseInt(hex.substring(4, 6), 16);
Â  Â  Â  } else {
Â  Â  Â  Â  return `rgba(128, 128, 128, ${alpha})`;
Â  Â  Â  }
Â  Â  Â  if (isNaN(r) || isNaN(g) || isNaN(b)) return `rgba(128,128,128,${alpha})`;
Â  Â  Â  return `rgba(${r},${g},${b},${alpha})`;
Â  Â  }

Â  Â  function initD3() {
Â  Â  Â  const fcCont = document.getElementById('flowchartContainer');
Â  Â  Â  d3.select(fcCont).select('svg').remove();
Â  Â  Â  const cW = fcCont.clientWidth,
Â  Â  Â  Â  cH = fcCont.clientHeight,
Â  Â  Â  Â  vW = Math.max(cW * 1.5, 2000),
Â  Â  Â  Â  vH = Math.max(cH * 1.5, 1500);
Â  Â  Â  svg = d3
Â  Â  Â  Â  .select(fcCont)
Â  Â  Â  Â  .append('svg')
Â  Â  Â  Â  .attr('id', 'flowchart')
Â  Â  Â  Â  .attr('width', '100%')
Â  Â  Â  Â  .attr('height', '100%')
Â  Â  Â  Â  .attr('viewBox', `0 0 ${vW} ${vH}`)
Â  Â  Â  Â  .attr('preserveAspectRatio', 'xMidYMid meet');
Â  Â  Â  mainZoomGroup = svg.append('g');

Â  Â  Â  const zm = d3.zoom().on('zoom', (ev) =>
Â  Â  Â  Â  mainZoomGroup.attr('transform', ev.transform)
Â  Â  Â  );
Â  Â  Â  svg.call(zm).on('dblclick.zoom', null);
Â  Â  Â  mainZoomGroup.append('defs');

Â  Â  Â  linkGroup = mainZoomGroup.append('g').attr('class', 'links');
Â  Â  Â  nodeGroup = mainZoomGroup.append('g').attr('class', 'nodes');

Â  Â  Â  const scaledNodeDimension = BASE_NODE_DIMENSION * currentNodeSizeFactor;
Â  Â  Â  simulation = d3
Â  Â  Â  Â  .forceSimulation()
Â  Â  Â  Â  .force(
Â  Â  Â  Â  Â  'charge',
Â  Â  Â  Â  Â  d3.forceManyBody().strength(-1800 * (scaledNodeDimension / 160))
Â  Â  Â  Â  )
Â  Â  Â  Â  .force(
Â  Â  Â  Â  Â  'collide',
Â  Â  Â  Â  Â  d3.forceCollide().radius((scaledNodeDimension * 0.55) + 25).strength(0.9)
Â  Â  Â  Â  )
Â  Â  Â  Â  .force('center', d3.forceCenter(vW / 2, vH / 2));

Â  Â  Â  window.addEventListener('resize', () => {
Â  Â  Â  Â  const nCW = fcCont.clientWidth,
Â  Â  Â  Â  Â  nCH = fcCont.clientHeight,
Â  Â  Â  Â  Â  nV_W = Math.max(nCW * 1.5, vW),
Â  Â  Â  Â  Â  nV_H = Math.max(nCH * 1.5, vH);
Â  Â  Â  Â  simulation
Â  Â  Â  Â  Â  .force('center', d3.forceCenter(nV_W / 2, nV_H / 2))
Â  Â  Â  Â  Â  .alpha(0.3)
Â  Â  Â  Â  Â  .restart();
Â  Â  Â  });
Â  Â  }

Â  Â  function placeNodesDiagonally() {
Â  Â  Â  const iX = mainZoomGroup.node()
Â  Â  Â  Â  Â  ? parseFloat(svg.attr('viewBox').split(' ')[2]) / 2
Â  Â  Â  Â  Â  : 1000,
Â  Â  Â  Â  iY = 150,
Â  Â  Â  Â  cSD = BASE_NODE_DIMENSION * currentNodeSizeFactor,
Â  Â  Â  Â  hS = cSD * 1.75,
Â  Â  Â  Â  vS = cSD * 1.25;
Â  Â  Â  data.nodes.forEach((n, i) => {
Â  Â  Â  Â  if (n.x == null || n.fx == null) {
Â  Â  Â  Â  Â  n.x = iX + (i % 3 - 1) * hS + (Math.random() * 50 - 25);
Â  Â  Â  Â  Â  n.fx = n.x;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (n.y == null || n.fy == null) {
Â  Â  Â  Â  Â  n.y = iY + Math.floor(i / 3) * vS + (Math.random() * 50 - 25);
Â  Â  Â  Â  Â  n.fy = n.y;
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  function addTaskRow(t) {
Â  Â  Â  const tb = document.querySelector('#taskTable tbody'),
Â  Â  Â  Â  tr = document.createElement('tr');
Â  Â  Â  tr.addEventListener('click', function () {
Â  Â  Â  Â  document
Â  Â  Â  Â  Â  .querySelectorAll('#taskTable tbody tr')
Â  Â  Â  Â  Â  .forEach((r) => r.classList.remove('selectedTaskRow'));
Â  Â  Â  Â  this.classList.add('selectedTaskRow');
Â  Â  Â  });
Â  Â  Â  const tdC = document.createElement('td'),
Â  Â  Â  Â  cb = document.createElement('input');
Â  Â  Â  cb.type = 'checkbox';
Â  Â  Â  cb.checked = t && t.completed ? true : false;
Â  Â  Â  tdC.appendChild(cb);
Â  Â  Â  const tdT = document.createElement('td'),
Â  Â  Â  Â  ti = document.createElement('textarea');
Â  Â  Â  ti.classList.add('task-detail-textarea');
Â  Â  Â  ti.value = t && t.task ? t.task : '';
Â  Â  Â  ti.rows = 1;
Â  Â  Â Â 
Â  Â  Â  ti.addEventListener('input', function () {
Â  Â  Â  Â  this.style.height = 'auto';
Â  Â  Â  Â  this.style.height = this.scrollHeight + 'px';
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  ti.addEventListener('dblclick', function (e) {
Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  tr.classList.add('selectedTaskRow');
Â  Â  Â  Â  showTaskPopup(this.value);
Â  Â  Â  });

Â  Â  Â  let pT;
Â  Â  Â  ti.addEventListener('touchstart', function (e) {
Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  pT = window.setTimeout(() => {
Â  Â  Â  Â  Â  tr.classList.add('selectedTaskRow');
Â  Â  Â  Â  Â  showTaskPopup(this.value);
Â  Â  Â  Â  }, 800);
Â  Â  Â  });
Â  Â  Â  ti.addEventListener('touchend', function () {
Â  Â  Â  Â  clearTimeout(pT);
Â  Â  Â  });
Â  Â  Â  ti.addEventListener('touchmove', function () {
Â  Â  Â  Â  clearTimeout(pT);
Â  Â  Â  });
Â  Â  Â  tdT.appendChild(ti);
Â  Â  Â  tr.appendChild(tdC);
Â  Â  Â  tr.appendChild(tdT);
Â  Â  Â  tb.appendChild(tr);
Â  Â  Â  ti.dispatchEvent(new Event('input'));
Â  Â  }

Â  Â  function populateTaskTable(str) {
Â  Â  Â  const tb = document.querySelector('#taskTable tbody');
Â  Â  Â  tb.innerHTML = '';
Â  Â  Â  let arr = [];
Â  Â  Â  if (str && typeof str === 'string') {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  arr = JSON.parse(str);
Â  Â  Â  Â  Â  if (!Array.isArray(arr)) arr = str.trim() ? [{ completed: false, task: str }] : [];
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  arr = str.trim() ? [{ completed: false, task: str }] : [];
Â  Â  Â  Â  }
Â  Â  Â  } else if (Array.isArray(str)) arr = str;

Â  Â  Â  if (arr.length > 0) arr.forEach((t) => addTaskRow(t));
Â  Â  Â  else addTaskRow({});
Â  Â  }

Â  Â  function showTaskPopup(txt) {
Â  Â  Â  document.getElementById('taskFullText').textContent = txt;
Â  Â  Â  document.getElementById('taskTextPopup').style.display = 'block';
Â  Â  }

Â  Â  function updateProjectDescButton() {
Â  Â  Â  const btn = document.getElementById('projectDescBtn');
Â  Â  Â  if (!btn) return;

Â  Â  Â  const pd = data.projectDescription || {};
Â  Â  Â  const hasDesc = pd.summary && pd.summary.trim().length > 0;
Â  Â  Â  btn.style.display = hasDesc ? 'inline-flex' : 'none';
Â  Â  }

Â  Â  // START: NEW FLOATING LEGEND LOGIC
Â  Â  function updateFloatingLegend() {
Â  Â  Â  const legendContainer = document.getElementById('colorLegendDisplay');
Â  Â  Â  legendContainer.innerHTML = '';
Â  Â  Â  let hasContent = false;
Â  Â  Â  for (const color in data.colorLegends) {
Â  Â  Â  Â  if (data.colorLegends[color]) {
Â  Â  Â  Â  Â  hasContent = true;
Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  item.className = 'legend-item';
Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="legend-color-box" style="background-color: ${color}"></div>
Â  Â  Â  Â  Â  Â  <span>${data.colorLegends[color]}</span>
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  legendContainer.appendChild(item);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  legendContainer.classList.toggle('visible', hasContent);
Â  Â  }
Â  Â  // END: NEW FLOATING LEGEND LOGIC

Â  Â  function nodeClick(ev, d) {
Â  Â  Â  ev.stopPropagation();
Â  Â  Â  selectedNode = d;
Â  Â  Â  const g = (id) => document.getElementById(id);
Â  Â  Â  g('taskName').value = d.name || '';
Â  Â  Â  g('responsible').value = d.responsible || '';
Â  Â  Â  g('status').value = d.status || 'Not Started';
Â  Â  Â  g('deadline').value = d.deadline || '';
Â  Â  Â  g('priority').value = d.priority || 'Normal';
Â  Â  Â  populateTaskTable(d.actionDescription || '');
Â  Â  Â  g('nodeColor').value = d.color || '';
Â  Â  Â  document.querySelectorAll('.color-swatch').forEach((s) =>
Â  Â  Â  Â  s.classList.remove('selected-swatch')
Â  Â  Â  );
Â  Â  Â  if (d.color) {
Â  Â  Â  Â  const sS = document.querySelector(`.color-swatch[data-color='${d.color}']`);
Â  Â  Â  Â  if (sS) sS.classList.add('selected-swatch');
Â  Â  Â  }
Â  Â  Â  g('modal').style.display = 'block';
Â  Â  }

Â  Â  function saveToFile() {
Â  Â  Â  try {
Â  Â  Â  Â  data.flowchartName =
Â  Â  Â  Â  Â  document.getElementById('flowchartNameInput').value || 'Untitled Flowchart';
Â  Â  Â  Â  const expD = {
Â  Â  Â  Â  Â  flowchartName: data.flowchartName,
Â  Â  Â  Â  Â  projectDescription: data.projectDescription,
Â  Â  Â  Â  Â  colorLegends: data.colorLegends, // <-- Save legends
Â  Â  Â  Â  Â  nodes: data.nodes.map((n) => ({
Â  Â  Â  Â  Â  Â  id: n.id,
Â  Â  Â  Â  Â  Â  name: n.name,
Â  Â  Â  Â  Â  Â  status: n.status,
Â  Â  Â  Â  Â  Â  responsible: n.responsible,
Â  Â  Â  Â  Â  Â  deadline: n.deadline,
Â  Â  Â  Â  Â  Â  priority: n.priority,
Â  Â  Â  Â  Â  Â  actionDescription: n.actionDescription,
Â  Â  Â  Â  Â  Â  color: n.color,
Â  Â  Â  Â  Â  Â  x: n.x,
Â  Â  Â  Â  Â  Â  y: n.y,
Â  Â  Â  Â  Â  Â  fx: n.fx,
Â  Â  Â  Â  Â  Â  fy: n.fy,
Â  Â  Â  Â  Â  })),
Â  Â  Â  Â  Â  links: data.links.map(l => ({
Â  Â  Â  Â  Â  Â  source: l.source.id || l.source,
Â  Â  Â  Â  Â  Â  target: l.target.id || l.target
Â  Â  Â  Â  Â  })),
Â  Â  Â  Â  };
Â  Â  Â  Â  const dS = JSON.stringify(expD, null, 2),
Â  Â  Â  Â  Â  blb = new Blob([dS], { type: 'application/json' }),
Â  Â  Â  Â  Â  url = URL.createObjectURL(blb),
Â  Â  Â  Â  Â  a = document.createElement('a');
Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  a.download =
Â  Â  Â  Â  Â  (expD.flowchartName.replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'flowchart') +
Â  Â  Â  Â  Â  '.json';
Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  a.click();
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  Â  } catch (rE) {
Â  Â  Â  Â  Â  Â  console.error('Revoke URL error:', rE);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 100);
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error('Save file error:', e);
Â  Â  Â  Â  alert('Error saving.');
Â  Â  Â  }
Â  Â  }

Â  Â  function loadFromFile(f) {
Â  Â  Â  if (!f) {
Â  Â  Â  Â  alert('No file.');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  const r = new FileReader();
Â  Â  Â  r.onload = (e) => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const fD = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  if (fD && typeof fD === 'object' && Array.isArray(fD.nodes)) {
Â  Â  Â  Â  Â  Â  data.flowchartName = fD.flowchartName || 'Untitled';
Â  Â  Â  Â  Â  Â  document.getElementById('flowchartNameInput').value = data.flowchartName;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  data.colorLegends = fD.colorLegends || {}; // <-- Load legends
Â  Â  Â  Â  Â  Â  updateFloatingLegend(); // <-- Update display after load

Â  Â  Â  Â  Â  Â  data.projectDescription =
Â  Â  Â  Â  Â  Â  Â  fD.projectDescription || { summary: '', generatedDate: '' };
Â  Â  Â  Â  Â  Â  updateProjectDescButton();

Â  Â  Â  Â  Â  Â  data.nodes = fD.nodes.map((n) => ({
Â  Â  Â  Â  Â  Â  Â  ...n,
Â  Â  Â  Â  Â  Â  Â  x: n.x,
Â  Â  Â  Â  Â  Â  Â  y: n.y,
Â  Â  Â  Â  Â  Â  Â  fx: n.fx !== undefined ? n.fx : n.x,
Â  Â  Â  Â  Â  Â  Â  fy: n.fy !== undefined ? n.fy : n.y,
Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  data.links = Array.isArray(fD.links) ? fD.links : [];

Â  Â  Â  Â  Â  Â  document.getElementById('fileNameDisplay').innerText = `Loaded: ${f.name}`;
Â  Â  Â  Â  Â  Â  document.getElementById('fileNameDisplay').title = `Loaded: ${f.name}`;
Â  Â  Â  Â  Â  Â  update();
Â  Â  Â  Â  Â  } else alert('Invalid format.');
Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  alert('Parse error.');
Â  Â  Â  Â  Â  console.error('Load file error:', err);
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  Â  r.onerror = () => alert('Read error.');
Â  Â  Â  r.readAsText(f);
Â  Â  }

Â  Â  function loadTemplate(tmpl) {
Â  Â  Â  data.flowchartName = tmpl.charAt(0).toUpperCase() + tmpl.slice(1) + ' Template';
Â  Â  Â  document.getElementById('flowchartNameInput').value = data.flowchartName;
Â  Â  Â  data.links = [];
Â  Â  Â  data.projectDescription = { summary: '', generatedDate: '' };
Â  Â  Â  data.colorLegends = {}; // Reset legends for template
Â  Â  Â  updateFloatingLegend(); // Update display
Â  Â  Â  updateProjectDescButton();
Â  Â  Â  switch (tmpl) {
Â  Â  Â  Â  case 'prototype':
Â  Â  Â  Â  Â  data.nodes = [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '1',
Â  Â  Â  Â  Â  Â  Â  name: 'Design System Setup and Component Library Integration',
Â  Â  Â  Â  Â  Â  Â  status: 'Completed',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#2ecc71',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '2',
Â  Â  Â  Â  Â  Â  Â  name: 'User Authentication and Profile Management Development',
Â  Â  Â  Â  Â  Â  Â  status: 'In Progress',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#f1c40f',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '3',
Â  Â  Â  Â  Â  Â  Â  name: 'Real-time Collaboration Feature Testing and Debugging',
Â  Â  Â  Â  Â  Â  Â  status: 'Not Started',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#e74c3c',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'vendor':
Â  Â  Â  Â  Â  data.nodes = [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '1',
Â  Â  Â  Â  Â  Â  Â  name: 'Identify Potential Software Vendors and Compile Shortlist',
Â  Â  Â  Â  Â  Â  Â  status: 'Completed',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#2ecc71',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '2',
Â  Â  Â  Â  Â  Â  Â  name: 'Conduct Vendor Outreach, Schedule Demos, and Collect RFPs',
Â  Â  Â  Â  Â  Â  Â  status: 'In Progress',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#f1c40f',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '3',
Â  Â  Â  Â  Â  Â  Â  name: 'Evaluate Proposals, Negotiate Terms, and Select Final Vendor',
Â  Â  Â  Â  Â  Â  Â  status: 'Not Started',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#e74c3c',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'marketing':
Â  Â  Â  Â  Â  data.nodes = [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '1',
Â  Â  Â  Â  Â  Â  Â  name: 'Comprehensive Market Research and Competitor Analysis',
Â  Â  Â  Â  Â  Â  Â  status: 'Completed',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#2ecc71',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '2',
Â  Â  Â  Â  Â  Â  Â  name: 'Marketing Campaign Strategy, Goal Setting, and Content Calendar Development',
Â  Â  Â  Â  Â  Â  Â  status: 'In Progress',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#f1c40f',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: '3',
Â  Â  Â  Â  Â  Â  Â  name: 'Campaign Asset Creation, Platform Setup, and Official Launch Execution',
Â  Â  Â  Â  Â  Â  Â  status: 'Not Started',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#e74c3c',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  data.nodes = [
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  id: 'root-1',
Â  Â  Â  Â  Â  Â  Â  name: 'Start New Project Here',
Â  Â  Â  Â  Â  Â  Â  status: 'Not Started',
Â  Â  Â  Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  Â  Â  Â  color: '#3498db',
Â  Â  Â  Â  Â  Â  Â  x: 300,
Â  Â  Â  Â  Â  Â  Â  y: 150,
Â  Â  Â  Â  Â  Â  Â  fx: 300,
Â  Â  Â  Â  Â  Â  Â  fy: 150,
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  data.flowchartName = 'New Flowchart';
Â  Â  Â  Â  Â  document.getElementById('flowchartNameInput').value = data.flowchartName;
Â  Â  Â  }
Â  Â  Â  data.nodes.forEach((n) => {
Â  Â  Â  Â  n.fx = null;
Â  Â  Â  Â  n.fy = null;
Â  Â  Â  });
Â  Â  Â  placeNodesDiagonally();
Â  Â  Â  update();
Â  Â  }

Â  Â  function findNode(id) {
Â  Â  Â  Â  return data.nodes.find(n => n.id === id);
Â  Â  }
Â  Â Â 
Â  Â  function linkClickHandler(event, d) {
Â  Â  Â  Â  event.stopPropagation();
Â  Â  Â  Â  selectedLink = d;
Â  Â  Â  Â Â 
Â  Â  Â  Â  linkGroup.selectAll('line.link').classed('selected', l => l === selectedLink);
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('deleteLinkModal').style.display = 'block';
Â  Â  }

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  try {
Â  Â  Â  Â  initD3();
Â  Â  Â  Â  updateFloatingLegend(); // Initial call
Â  Â  Â  Â  const g = (id) => document.getElementById(id);

Â  Â  Â  Â  // START: TOOLTIP INITIALIZATION SCRIPT
Â  Â  Â  Â  const tooltip = document.getElementById('tooltip');
Â  Â  Â  Â  if (tooltip) {
Â  Â  Â  Â  Â  const tooltipButtons = document.querySelectorAll('nav button[data-tooltip-text]');
Â  Â  Â  Â  Â  tooltipButtons.forEach(button => {
Â  Â  Â  Â  Â  Â  button.addEventListener('mouseenter', () => {
Â  Â  Â  Â  Â  Â  Â  const text = button.dataset.tooltipText;
Â  Â  Â  Â  Â  Â  Â  if (text) {
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.textContent = text;
Â  Â  Â  Â  Â  Â  Â  Â  const rect = button.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  const top = rect.bottom + 8; // 8px below the button
Â  Â  Â  Â  Â  Â  Â  Â  const left = rect.left + rect.width / 2; // Centered horizontally
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.top = `${top}px`;
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.style.left = `${left}px`;
Â  Â  Â  Â  Â  Â  Â  Â  tooltip.classList.add('visible');
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  button.addEventListener('mouseleave', () => {
Â  Â  Â  Â  Â  Â  Â  tooltip.classList.remove('visible');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  // END: TOOLTIP INITIALIZATION SCRIPT

Â  Â  Â  Â  // START: COLOR LEGEND MODAL LOGIC
Â  Â  Â  Â  const colorLegendBtn = g('colorLegendBtn');
Â  Â  Â  Â  const colorLegendModal = g('colorLegendModal');
Â  Â  Â  Â  const closeColorLegendModalBtn = g('closeColorLegendModal');
Â  Â  Â  Â  const colorLegendForm = g('colorLegendForm');
Â  Â  Â  Â  const colorLegendEntriesDiv = g('colorLegendEntries');

Â  Â  Â  Â  colorLegendBtn.onclick = () => {
Â  Â  Â  Â  Â  colorLegendEntriesDiv.innerHTML = ''; // Clear previous entries
Â  Â  Â  Â  Â  NODE_COLORS.forEach(color => {
Â  Â  Â  Â  Â  Â  const currentValue = data.colorLegends[color] || '';
Â  Â  Â  Â  Â  Â  const entryHTML = `
Â  Â  Â  Â  Â  Â  Â  <div class="color-legend-entry">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="color-legend-swatch" style="background-color: ${color}"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="color-legend-input" data-color="${color}" value="${currentValue}" placeholder="Enter description for ${color}â€¦">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  colorLegendEntriesDiv.insertAdjacentHTML('beforeend', entryHTML);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  colorLegendModal.style.display = 'block';
Â  Â  Â  Â  };

Â  Â  Â  Â  closeColorLegendModalBtn.onclick = () => {
Â  Â  Â  Â  Â  colorLegendModal.style.display = 'none';
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  colorLegendForm.onsubmit = (e) => {
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  const inputs = colorLegendEntriesDiv.querySelectorAll('.color-legend-input');
Â  Â  Â  Â  Â  data.colorLegends = {}; // Reset before saving
Â  Â  Â  Â  Â  inputs.forEach(input => {
Â  Â  Â  Â  Â  Â  data.colorLegends[input.dataset.color] = input.value.trim();
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  updateFloatingLegend();
Â  Â  Â  Â  Â  colorLegendModal.style.display = 'none';
Â  Â  Â  Â  };
Â  Â  Â  Â  // END: COLOR LEGEND MODAL LOGIC

Â  Â  Â  Â  if (g('aiAssistantBtn')) g('aiAssistantBtn').onclick = openAIAssistant;
Â  Â  Â  Â  if (g('nodeSizeIncreaseBtn')) g('nodeSizeIncreaseBtn').onclick = () => {
Â  Â  Â  Â  Â  if (currentNodeSizeFactor < MAX_NODE_SIZE_FACTOR) {
Â  Â  Â  Â  Â  Â  currentNodeSizeFactor = parseFloat(
Â  Â  Â  Â  Â  Â  Â  (currentNodeSizeFactor + NODE_SIZE_STEP).toFixed(2)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  updateNodeSizes();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  if (g('nodeSizeDecreaseBtn')) g('nodeSizeDecreaseBtn').onclick = () => {
Â  Â  Â  Â  Â  if (currentNodeSizeFactor > MIN_NODE_SIZE_FACTOR) {
Â  Â  Â  Â  Â  Â  currentNodeSizeFactor = parseFloat(
Â  Â  Â  Â  Â  Â  Â  (currentNodeSizeFactor - NODE_SIZE_STEP).toFixed(2)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  updateNodeSizes();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  document.querySelectorAll('.color-swatch').forEach((s) =>
Â  Â  Â  Â  Â  s.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  document
Â  Â  Â  Â  Â  Â  Â  .querySelectorAll('.color-swatch')
Â  Â  Â  Â  Â  Â  Â  .forEach((x) => x.classList.remove('selected-swatch'));
Â  Â  Â  Â  Â  Â  s.classList.add('selected-swatch');
Â  Â  Â  Â  Â  Â  g('nodeColor').value = s.dataset.color;
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  );

Â  Â  Â  Â  if (g('templateBtn')) g('templateBtn').onclick = () => {
Â  Â  Â  Â  Â  g('templateModal').style.display = 'block';
Â  Â  Â  Â  };
Â  Â  Â  Â  document.querySelectorAll('.template-btn').forEach((b) => (b.onclick = (e) => {
Â  Â  Â  Â  Â  loadTemplate(e.target.dataset.template);
Â  Â  Â  Â  Â  g('templateModal').style.display = 'none';
Â  Â  Â  Â  }));
Â  Â  Â  Â Â 
Â  Â  Â  Â  const addConnBtn = document.getElementById('addConnectorBtn');
Â  Â  Â  Â  const svgEl = document.getElementById('flowchart');
Â  Â  Â  Â  if (addConnBtn && svgEl) {
Â  Â  Â  Â  Â  Â  addConnBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  connectorMode = !connectorMode;
Â  Â  Â  Â  Â  Â  Â  connectorStartNode = null;
Â  Â  Â  Â  Â  Â  Â  svgEl.style.cursor = connectorMode ? 'crosshair' : 'default';
Â  Â  Â  Â  Â  Â  Â  addConnBtn.classList.toggle('active', connectorMode);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  if (g('addNodeBtn')) g('addNodeBtn').onclick = (e) => {
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  const nN = createNode(selectedNode);
Â  Â  Â  Â  Â  if (nN) {
Â  Â  Â  Â  Â  Â  selectedNode = nN;
Â  Â  Â  Â  Â  Â  nodeClick({ stopPropagation: () => {} }, nN);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const saveButton = document.getElementById('saveBtn');
Â  Â  Â  Â  if (saveButton) saveButton.onclick = saveToFile;

Â  Â  Â  Â  if (g('uploadBtn') && g('fileInput')) {
Â  Â  Â  Â  Â  g('uploadBtn').onclick = () => g('fileInput').click();
Â  Â  Â  Â  Â  g('fileInput').onchange = (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.files.length > 0) loadFromFile(e.target.files[0]);
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  const userGuideBtn = g('userGuideBtn');
Â  Â  Â  Â  const userGuideModal = g('userGuideModal');
Â  Â  Â  Â  const closeUserGuideModalBtn = g('closeUserGuideModal');
Â  Â  Â  Â  if (userGuideBtn && userGuideModal && closeUserGuideModalBtn) {
Â  Â  Â  Â  Â  userGuideBtn.onclick = () => (userGuideModal.style.display = 'block');
Â  Â  Â  Â  Â  closeUserGuideModalBtn.onclick = () => (userGuideModal.style.display = 'none');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const shareBtn = g('shareBtn');
Â  Â  Â  Â  const shareModal = g('shareModal');
Â  Â  Â  Â  const closeShareModalBtn = g('closeShareModal');
Â  Â  Â  Â  if (shareBtn && shareModal && closeShareModalBtn) {
Â  Â  Â  Â  Â  Â  shareBtn.onclick = () => (shareModal.style.display = 'block');
Â  Â  Â  Â  Â  Â  closeShareModalBtn.onclick = () => (shareModal.style.display = 'none');
Â  Â  Â  Â  }

Â  Â  Â  Â  const projectDescBtn = g('projectDescBtn');
Â  Â  Â  Â  const projectDescModal = g('projectDescModal');
Â  Â  Â  Â  const projectSummaryEl = g('projectSummary');
Â  Â  Â  Â  const projectGeneratedDateEl = g('projectGeneratedDate');
Â  Â  Â  Â  updateProjectDescButton();
Â  Â  Â  Â  if (projectDescBtn && projectDescModal && projectSummaryEl && projectGeneratedDateEl) {
Â  Â  Â  Â  Â  projectDescBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  const pd = data.projectDescription || {};
Â  Â  Â  Â  Â  Â  if (pd.summary && pd.generatedDate) {
Â  Â  Â  Â  Â  Â  Â  projectSummaryEl.textContent = pd.summary;
Â  Â  Â  Â  Â  Â  Â  projectGeneratedDateEl.textContent = `Generated: ${pd.generatedDate}`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  projectSummaryEl.textContent = 'File does not contain a Project Description.';
Â  Â  Â  Â  Â  Â  Â  projectGeneratedDateEl.textContent = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  projectDescModal.style.display = 'block';
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.querySelectorAll('.modal .close-button').forEach((b) => {
Â  Â  Â  Â  Â  if (
Â  Â  Â  Â  Â  Â  b.id !== 'closeUserGuideModal' &&
Â  Â  Â  Â  Â  Â  b.id !== 'closeProjectDescModal' &&
Â  Â  Â  Â  Â  Â  b.id !== 'closeShareModal' &&
Â  Â  Â  Â  Â  Â  b.id !== 'closeColorLegendModal' // Ensure this is handled separately if needed
Â  Â  Â  Â  Â  ) {
Â  Â  Â  Â  Â  Â  b.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  b.closest('.modal').style.display = 'none';
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  if (g('closeProjectDescModal')) {
Â  Â  Â  Â  Â  g('closeProjectDescModal').onclick = (e) => {
Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  document.getElementById('projectDescModal').style.display = 'none';
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  Â  window.onclick = (e) => {
Â  Â  Â  Â  Â  if (e.target.classList.contains('modal')) e.target.style.display = 'none';
Â  Â  Â  Â  };

Â  Â  Â  Â  if (g('taskForm'))
Â  Â  Â  Â  Â  g('taskForm').onsubmit = (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  if (selectedNode) {
Â  Â  Â  Â  Â  Â  Â  let tsks = [];
Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#taskTable tbody tr').forEach((r) => {
Â  Â  Â  Â  Â  Â  Â  Â  let chk = r.querySelector('input[type="checkbox"]'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  txt = r.querySelector('textarea.task-detail-textarea');
Â  Â  Â  Â  Â  Â  Â  Â  if (txt && txt.value.trim() !== '')
Â  Â  Â  Â  Â  Â  Â  Â  Â  tsks.push({ completed: chk.checked, task: txt.value.trim() });
Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Object.assign(selectedNode, {
Â  Â  Â  Â  Â  Â  Â  Â  name: g('taskName').value,
Â  Â  Â  Â  Â  Â  Â  Â  responsible: g('responsible').value,
Â  Â  Â  Â  Â  Â  Â  Â  status: g('status').value,
Â  Â  Â  Â  Â  Â  Â  Â  deadline: g('deadline').value,
Â  Â  Â  Â  Â  Â  Â  Â  priority: g('priority').value,
Â  Â  Â  Â  Â  Â  Â  Â  actionDescription: JSON.stringify(tsks),
Â  Â  Â  Â  Â  Â  Â  Â  color: g('nodeColor').value || null,
Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  selectedNode.fx = selectedNode.x;
Â  Â  Â  Â  Â  Â  Â  selectedNode.fy = selectedNode.y;
Â  Â  Â  Â  Â  Â  Â  update();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  g('modal').style.display = 'none';
Â  Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const deleteLinkModal = g('deleteLinkModal');
Â  Â  Â  Â  const confirmDeleteLinkBtn = g('confirmDeleteLinkBtn');
Â  Â  Â  Â  const cancelDeleteLinkBtn = g('cancelDeleteLinkBtn');

Â  Â  Â  Â  const closeDeleteLinkModal = () => {
Â  Â  Â  Â  Â  Â  deleteLinkModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  linkGroup.selectAll('line.link').classed('selected', false);
Â  Â  Â  Â  Â  Â  selectedLink = null;
Â  Â  Â  Â  }

Â  Â  Â  Â  confirmDeleteLinkBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  if (selectedLink) {
Â  Â  Â  Â  Â  Â  Â  Â  data.links = data.links.filter(l => l !== selectedLink);
Â  Â  Â  Â  Â  Â  Â  Â  update();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  closeDeleteLinkModal();
Â  Â  Â  Â  };
Â  Â  Â  Â  cancelDeleteLinkBtn.onclick = closeDeleteLinkModal;


Â  Â  Â  Â  if (g('addTaskRowBtn'))
Â  Â  Â  Â  Â  g('addTaskRowBtn').addEventListener('click', () => addTaskRow({}));
Â  Â  Â  Â  if (g('deleteTaskBtn'))
Â  Â  Â  Â  Â  g('deleteTaskBtn').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  let sR = document.querySelector('#taskTable tbody tr.selectedTaskRow');
Â  Â  Â  Â  Â  Â  if (sR) sR.remove();
Â  Â  Â  Â  Â  Â  g('taskTextPopup').style.display = 'none';
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  if (g('deleteNodeBtn'))
Â  Â  Â  Â  Â  g('deleteNodeBtn').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (selectedNode && confirm('Delete node? This will also remove any connectors attached to it.')) {
Â  Â  Â  Â  Â  Â  Â  const selectedId = selectedNode.id;
Â  Â  Â  Â  Â  Â  Â  data.nodes = data.nodes.filter((n) => n.id !== selectedId);
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  data.links = data.links.filter(
Â  Â  Â  Â  Â  Â  Â  Â  (l) => (l.source.id || l.source) !== selectedId &&
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â (l.target.id || l.target) !== selectedId
Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  selectedNode = null;
Â  Â  Â  Â  Â  Â  Â  update();
Â  Â  Â  Â  Â  Â  Â  g('modal').style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  if (g('flowchartNameInput'))
Â  Â  Â  Â  Â  g('flowchartNameInput').addEventListener('input', function () {
Â  Â  Â  Â  Â  Â  data.flowchartName = this.value || 'Untitled';
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  if (data.nodes.length === 0) loadTemplate('prototype');
Â  Â  Â  Â  else update();
Â  Â  Â  } catch (dE) {
Â  Â  Â  Â  console.error('DOMContentLoaded error:', dE);
Â  Â  Â  }
Â  Â  });

Â  Â  function createNode(pN) {
Â  Â  Â  const nId = `node-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;
Â  Â  Â  let iX, iY;
Â  Â  Â  const vB = svg.attr('viewBox').split(' '),
Â  Â  Â  Â  vW = parseFloat(vB[2]),
Â  Â  Â  Â  vH = parseFloat(vB[3]),
Â  Â  Â  Â  cSD = BASE_NODE_DIMENSION * currentNodeSizeFactor;
Â  Â  Â  if (pN && typeof pN.x === 'number' && typeof pN.y === 'number') {
Â  Â  Â  Â  iX = pN.x + (Math.random() * 100 - 50);
Â  Â  Â  Â  iY = pN.y + cSD * 0.9 + (Math.random() * 20 - 10);
Â  Â  Â  } else {
Â  Â  Â  Â  iX = vW / 2 + (Math.random() * 200 - 100);
Â  Â  Â  Â  iY = vH / 3 + (Math.random() * 100 - 50);
Â  Â  Â  }
Â  Â  Â  iX = Math.max(cSD / 2, Math.min(iX, vW - cSD / 2));
Â  Â  Â  iY = Math.max(cSD / 2, Math.min(iY, vH - cSD / 2));
Â  Â  Â  const nN = {
Â  Â  Â  Â  id: nId,
Â  Â  Â  Â  name: 'New Task Node',
Â  Â  Â  Â  status: 'Not Started',
Â  Â  Â  Â  responsible: '',
Â  Â  Â  Â  deadline: '',
Â  Â  Â  Â  priority: 'Normal',
Â  Â  Â  Â  actionDescription: '[]',
Â  Â  Â  Â  color: null,
Â  Â  Â  Â  x: iX,
Â  Â  Â  Â  y: iY,
Â  Â  Â  Â  fx: iX,
Â  Â  Â  Â  fy: iY,
Â  Â  Â  };
Â  Â  Â  data.nodes.push(nN);
Â  Â  Â  update();
Â  Â  Â  return nN;
Â  Â  }

Â  Â  function updateNodeSizes() {
Â  Â  Â  if (!simulation) return;
Â  Â  Â  const sD = BASE_NODE_DIMENSION * currentNodeSizeFactor;
Â  Â  Â  simulation.force('collide').radius((sD * 0.55) + 25);
Â  Â  Â  simulation.force('charge').strength(-1800 * (sD / 160));
Â  Â  Â  update();
Â  Â  Â  simulation.alpha(0.3).restart();
Â  Â  }
Â  Â Â 
Â  Â  function update() {
Â  Â  Â  Â  if (!svg || !simulation) {
Â  Â  Â  Â  Â  Â  console.error('D3 not initialized for update');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const currentScaledDimension = BASE_NODE_DIMENSION * currentNodeSizeFactor;
Â  Â  Â  Â  const baseNodeNameFontSizePx = 14;
Â  Â  Â  Â  const basePillFontSizePx = 12;

Â  Â  Â  Â  let link = linkGroup.selectAll('line.link').data(data.links, d => `${d.source.id || d.source}-${d.target.id || d.target}`);
Â  Â  Â  Â  link.exit().remove();
Â  Â  Â  Â  link = link.enter()
Â  Â  Â  Â  Â  Â  .append('line')
Â  Â  Â  Â  Â  Â  .attr('class', 'link')
Â  Â  Â  Â  Â  Â  .attr('stroke', 'var(--link-color)')
Â  Â  Â  Â  Â  Â  .attr('stroke-width', 2.5)
Â  Â  Â  Â  Â  Â  .on('click', linkClickHandler)
Â  Â  Â  Â  Â  Â  .merge(link);

Â  Â  Â  Â  let node = nodeGroup.selectAll('g.node-group').data(data.nodes, d => d.id);
Â  Â  Â  Â  node.exit().remove();
Â  Â  Â  Â Â 
Â  Â  Â  Â  const nodeEnter = node.enter()
Â  Â  Â  Â  Â  Â  .append('g')
Â  Â  Â  Â  Â  Â  .attr('class', 'node-group')
Â  Â  Â  Â  Â  Â  .call(d3.drag().on('start', dragStart).on('drag', dragging).on('end', dragEnd));

Â  Â  Â  Â  nodeEnter.append('foreignObject')
Â  Â  Â  Â  Â  Â  .attr('class', 'flowchart-node-html-wrapper')
Â  Â  Â  Â  Â  Â  .append('xhtml:div')
Â  Â  Â  Â  Â  Â  .attr('class', 'flowchart-node-html');
Â  Â  Â  Â Â 
Â  Â  Â  Â  node = nodeEnter.merge(node);
Â  Â  Â  Â Â 
Â  Â  Â  Â  node.on('click', (event, d) => {
Â  Â  Â  Â  Â  Â  event.stopPropagation();
Â  Â  Â  Â  Â  Â  if (connectorMode) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!connectorStartNode) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  connectorStartNode = d;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (d.id !== connectorStartNode.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const linkExists = data.links.some(l =>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ((l.source.id || l.source) === connectorStartNode.id && (l.target.id || l.target) === d.id) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ((l.source.id || l.source) === d.id && (l.target.id || l.target) === connectorStartNode.id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!linkExists) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.links.push({ source: connectorStartNode.id, target: d.id });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  update();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  connectorMode = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  connectorStartNode = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('flowchart').style.cursor = 'default';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('addConnectorBtn').classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  nodeClick(event, d);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  node.select('foreignObject')
Â  Â  Â  Â  Â  Â  .attr('width', currentScaledDimension)
Â  Â  Â  Â  Â  Â  .attr('height', currentScaledDimension)
Â  Â  Â  Â  Â  Â  .attr('x', -currentScaledDimension / 2)
Â  Â  Â  Â  Â  Â  .attr('y', -currentScaledDimension / 2);

Â  Â  Â  Â  node.select('.flowchart-node-html').each(function(d) {
Â  Â  Â  Â  Â  Â  const nodeOuterDiv = d3.select(this);
Â  Â  Â  Â  Â  Â  const nodeFillOpacity = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--node-fill-opacity').trim() || '0.7');
Â  Â  Â  Â  Â  Â  const baseColorHex = d.color ? d.color : getStatusColor(d.status);
Â  Â  Â  Â  Â  Â  nodeOuterDiv.style('background-color', hexToRgba(baseColorHex, nodeFillOpacity));

Â  Â  Â  Â  Â  Â  let prDiv = nodeOuterDiv.select('.priority-indicator');
Â  Â  Â  Â  Â  Â  if (prDiv.empty()) {
Â  Â  Â  Â  Â  Â  Â  Â  prDiv = nodeOuterDiv.append('div').attr('class', 'priority-indicator');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  let indicatorHtml = 'âšªï¸ âšªï¸ âšªï¸';
Â  Â  Â  Â  Â  Â  if (d.priority === 'Low') indicatorHtml = 'ğŸ”´ âšªï¸ âšªï¸';
Â  Â  Â  Â  Â  Â  else if (d.priority === 'Normal') indicatorHtml = 'ğŸ”´ ğŸ”´ âšªï¸';
Â  Â  Â  Â  Â  Â  else if (d.priority === 'High') indicatorHtml = 'ğŸ”´ ğŸ”´ ğŸ”´';
Â  Â  Â  Â  Â  Â  prDiv.html(indicatorHtml);

Â  Â  Â  Â  Â  Â  let pillDiv = nodeOuterDiv.select('.task-count-pill-html');
Â  Â  Â  Â  Â  Â  if (pillDiv.empty()) pillDiv = nodeOuterDiv.append('div').attr('class', 'task-count-pill-html');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let nameDiv = nodeOuterDiv.select('.node-name-html');
Â  Â  Â  Â  Â  Â  if (nameDiv.empty()) nameDiv = nodeOuterDiv.append('div').attr('class', 'node-name-html');

Â  Â  Â  Â  Â  Â  nameDiv.text(d.name || '').style('font-size', `${Math.max(10, baseNodeNameFontSizePx * currentNodeSizeFactor)}px`);

Â  Â  Â  Â  Â  Â  let tasks = [];
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (d.actionDescription) tasks = JSON.parse(d.actionDescription);
Â  Â  Â  Â  Â  Â  } catch (e) { /* Gracefully handle invalid JSON */ }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const compC = tasks.filter((t) => t.completed).length;
Â  Â  Â  Â  Â  Â  const totC = tasks.length;
Â  Â  Â  Â  Â  Â  if (totC > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  pillDiv.text(`âœ“ ${compC}/${totC}`).style('display', 'block').style('font-size', `${Math.max(9, basePillFontSizePx * currentNodeSizeFactor)}px`);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  pillDiv.style('display', 'none');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  simulation.nodes(data.nodes);
Â  Â  Â  Â  if (data.links) {
Â  Â  Â  Â  Â  Â  const linkForce = d3.forceLink(data.links).id(d => d.id).distance(250).strength(0.05);
Â  Â  Â  Â  Â  Â  simulation.force('link', linkForce);
Â  Â  Â  Â  }

Â  Â  Â  Â  simulation.on('tick', () => {
Â  Â  Â  Â  Â  Â  node.attr('transform', d => `translate(${d.x},${d.y})`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  link.each(function(d) {
Â  Â  Â  Â  Â  Â  Â  Â  if (d.source && d.target && typeof d.source.x === 'number' && typeof d.target.x === 'number') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sourcePoint = getIntersectionPoint(d.source, d.target, currentScaledDimension, currentScaledDimension);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetPoint = getIntersectionPoint(d.target, d.source, currentScaledDimension, currentScaledDimension);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d3.select(this)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .attr('x1', sourcePoint.x)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .attr('y1', sourcePoint.y)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .attr('x2', targetPoint.x)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .attr('y2', targetPoint.y);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  simulation.alpha(1).restart();
Â  Â  }


Â  Â  function getStatusColor(s) {
Â  Â  Â  switch (s) {
Â  Â  Â  Â  case 'Not Started':
Â  Â  Â  Â  Â  return '#e74c3c';
Â  Â  Â  Â  case 'In Progress':
Â  Â  Â  Â  Â  return '#f1c40f';
Â  Â  Â  Â  case 'Completed':
Â  Â  Â  Â  Â  return '#2ecc71';
Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  return '#3498db';
Â  Â  Â  }
Â  Â  }

Â  Â  function dragStart(ev, d) {
Â  Â  Â  if (!ev.active) simulation.alphaTarget(0.3).restart();
Â  Â  Â  d.fx = d.x;
Â  Â  Â  d.fy = d.y;
Â  Â  }

Â  Â  function dragging(ev, d) {
Â  Â  Â  d.fx = ev.x;
Â  Â  Â  d.fy = ev.y;
Â  Â  }

Â  Â  function dragEnd(ev, d) {
Â  Â  Â  if (!ev.active) simulation.alphaTarget(0);
Â  Â  }

Â  Â  function getIntersectionPoint(sourceNode, targetNode, width, height) {
Â  Â  Â  Â  const sx = sourceNode.x;
Â  Â  Â  Â  const sy = sourceNode.y;
Â  Â  Â  Â  const tx = targetNode.x;
Â  Â  Â  Â  const ty = targetNode.y;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const dx = tx - sx;
Â  Â  Â  Â  const dy = ty - sy;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (dx === 0 && dy === 0) {
Â  Â  Â  Â  Â  Â  return { x: sx, y: sy };
Â  Â  Â  Â  }

Â  Â  Â  Â  const halfWidth = width / 2;
Â  Â  Â  Â  const halfHeight = height / 2;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const slope = dy / dx;
Â  Â  Â  Â  const rectSlope = halfHeight / halfWidth;

Â  Â  Â  Â  let ix, iy;

Â  Â  Â  Â  if (Math.abs(slope) < rectSlope) {
Â  Â  Â  Â  Â  Â  if (dx > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  ix = sx + halfWidth;
Â  Â  Â  Â  Â  Â  Â  Â  iy = sy + halfWidth * slope;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  ix = sx - halfWidth;
Â  Â  Â  Â  Â  Â  Â  Â  iy = sy - halfWidth * slope;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (dy > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  iy = sy + halfHeight;
Â  Â  Â  Â  Â  Â  Â  Â  ix = sx + halfHeight / slope;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  iy = sy - halfHeight;
Â  Â  Â  Â  Â  Â  Â  Â  ix = sx - halfHeight / slope;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  return { x: ix, y: iy };
Â  Â  }
Â  </script>
</body>
</html>
